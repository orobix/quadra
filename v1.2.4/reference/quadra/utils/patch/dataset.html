
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Quadra">
      
      
      
        <link rel="canonical" href="https://orobix.github.io/quadra/v1.2.4/reference/quadra/utils/patch/dataset.html">
      
      
        <link rel="prev" href="index.html">
      
      
        <link rel="next" href="metrics.html">
      
      
      <link rel="icon" href="../../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.8">
    
    
      
        <title>dataset - Quadra</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../css/colors.css">
    
      <link rel="stylesheet" href="../../../../css/mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../css/landing.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quadra.utils.patch.dataset" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest version.
  <a href="../../../../.."> 
    <strong>Click here to go to latest.</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../index.html" title="Quadra" class="md-header__button md-logo" aria-label="Quadra" data-md-component="logo">
      
  <img src="../../../../images/quadra_logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Quadra
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              dataset
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/orobix/quadra" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Orobix/quadra
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../index.html" class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../getting_started.html" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../index.html" class="md-tabs__link">
          
  
  Code Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../tutorials/datamodules.html" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../SUMMARY.html" class="md-tabs__link">
        
  
    
  
  Package Summary

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../CHANGELOG.html" class="md-tabs__link">
        
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../index.html" title="Quadra" class="md-nav__button md-logo" aria-label="Quadra" data-md-component="logo">
      
  <img src="../../../../images/quadra_logo.svg" alt="logo">

    </a>
    Quadra
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/orobix/quadra" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Orobix/quadra
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../../getting_started.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Code Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    quadra
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            quadra
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../callbacks/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    callbacks
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_1">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_1">
            <span class="md-nav__icon md-icon"></span>
            callbacks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../callbacks/anomalib.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    anomalib
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../callbacks/lightning.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lightning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../callbacks/mlflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mlflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../callbacks/scheduler.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    scheduler
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../datamodules/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    datamodules
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2">
            <span class="md-nav__icon md-icon"></span>
            datamodules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/anomaly.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    anomaly
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_2_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../datamodules/generic/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    generic
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_2_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_2_4">
            <span class="md-nav__icon md-icon"></span>
            generic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/generic/imagenette.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    imagenette
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/generic/mnist.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mnist
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/generic/mvtec.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mvtec
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/generic/oxford_pet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    oxford_pet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/patch.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    patch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/segmentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datamodules/ssl.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ssl
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../datasets/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    datasets
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_3">
            <span class="md-nav__icon md-icon"></span>
            datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/anomaly.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    anomaly
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/patch.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    patch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/segmentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../datasets/ssl.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ssl
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../losses/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    losses
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4">
            <span class="md-nav__icon md-icon"></span>
            losses
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../losses/classification/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    classification
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_4_1">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4_1">
            <span class="md-nav__icon md-icon"></span>
            classification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/classification/asl.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asl
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/classification/focal.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    focal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/classification/prototypical.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    prototypical
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../losses/ssl/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ssl
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_4_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4_2">
            <span class="md-nav__icon md-icon"></span>
            ssl
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/ssl/barlowtwins.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    barlowtwins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/ssl/byol.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    byol
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/ssl/dino.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dino
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/ssl/hyperspherical.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hyperspherical
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/ssl/idmm.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    idmm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/ssl/simclr.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    simclr
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/ssl/simsiam.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    simsiam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../losses/ssl/vicreg.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vicreg
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../main.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    main
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../metrics/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    metrics
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_6">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_6">
            <span class="md-nav__icon md-icon"></span>
            metrics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../metrics/segmentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segmentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../models/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    models
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_7">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_7">
            <span class="md-nav__icon md-icon"></span>
            models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_7_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../models/classification/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    classification
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_7_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_7_2">
            <span class="md-nav__icon md-icon"></span>
            classification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/classification/backbones.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    backbones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/classification/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../models/evaluation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    evaluation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../modules/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    modules
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_8">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_8">
            <span class="md-nav__icon md-icon"></span>
            modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/backbone.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    backbone
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_8_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../modules/classification/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    classification
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_8_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_8_3">
            <span class="md-nav__icon md-icon"></span>
            classification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/classification/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_8_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../modules/ssl/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ssl
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_8_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_8_4">
            <span class="md-nav__icon md-icon"></span>
            ssl
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ssl/barlowtwins.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    barlowtwins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ssl/byol.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    byol
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ssl/common.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ssl/dino.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dino
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ssl/hyperspherical.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hyperspherical
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ssl/idmm.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    idmm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ssl/simclr.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    simclr
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ssl/simsiam.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    simsiam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/ssl/vicreg.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vicreg
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../optimizers/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    optimizers
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_9">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_9">
            <span class="md-nav__icon md-icon"></span>
            optimizers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../optimizers/lars.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lars
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../optimizers/sam.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sam
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../schedulers/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    schedulers
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_10">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_10">
            <span class="md-nav__icon md-icon"></span>
            schedulers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../schedulers/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../schedulers/warmup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    warmup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tasks/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    tasks
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_11">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_11">
            <span class="md-nav__icon md-icon"></span>
            tasks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/anomaly.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    anomaly
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/base.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/patch.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    patch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/segmentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tasks/ssl.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ssl
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../trainers/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    trainers
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_12">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_12">
            <span class="md-nav__icon md-icon"></span>
            trainers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../trainers/classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    classification
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_13" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    utils
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_13">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_13_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1_13">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../deprecation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deprecation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../evaluation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    evaluation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../export.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    export
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../imaging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    imaging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../logger.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    logger
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../mlflow.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mlflow
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../model_manager.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    model_manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../models.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_13_10" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    patch
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_13_10">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_13_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1_13_10">
            <span class="md-nav__icon md-icon"></span>
            patch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    dataset
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="dataset.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    dataset
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset" class="md-nav__link">
    dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.InvalidNumWorkersNumberException" class="md-nav__link">
    InvalidNumWorkersNumberException
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.InvalidParameterCombinationException" class="md-nav__link">
    InvalidParameterCombinationException
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.PatchDatasetFileFormat" class="md-nav__link">
    PatchDatasetFileFormat
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.PatchDatasetInfo" class="md-nav__link">
    PatchDatasetInfo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.__save_patch_dataset" class="md-nav__link">
    __save_patch_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.compute_patch_info" class="md-nav__link">
    compute_patch_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.compute_patch_info_from_patch_dim" class="md-nav__link">
    compute_patch_info_from_patch_dim()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.compute_safe_patch_range" class="md-nav__link">
    compute_safe_patch_range()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.create_h5" class="md-nav__link">
    create_h5()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.extract_patches" class="md-nav__link">
    extract_patches()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.from_rgb_to_idx" class="md-nav__link">
    from_rgb_to_idx()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.generate_patch_dataset" class="md-nav__link">
    generate_patch_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.generate_patch_sampling_dataset" class="md-nav__link">
    generate_patch_sampling_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.generate_patch_sliding_window_dataset" class="md-nav__link">
    generate_patch_sliding_window_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.get_image_mask_association" class="md-nav__link">
    get_image_mask_association()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.load_train_file" class="md-nav__link">
    load_train_file()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.multilabel_stratification" class="md-nav__link">
    multilabel_stratification()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.triangle_area" class="md-nav__link">
    triangle_area()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.triangulate_region" class="md-nav__link">
    triangulate_region()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.trisample" class="md-nav__link">
    trisample()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="metrics.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="model.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="visualization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    visualization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../resolver.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    resolver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../segmentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_13_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../tests/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    tests
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_13_13">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_1_13_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_13_13">
            <span class="md-nav__icon md-icon"></span>
            tests
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_13_13_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../tests/fixtures/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    fixtures
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_13_13_1">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_3_1_13_13_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_13_13_1">
            <span class="md-nav__icon md-icon"></span>
            fixtures
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_13_13_1_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../tests/fixtures/dataset/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    dataset
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_13_13_1_1">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_1_13_13_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_13_13_1_1">
            <span class="md-nav__icon md-icon"></span>
            dataset
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tests/fixtures/dataset/anomaly.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    anomaly
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tests/fixtures/dataset/classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tests/fixtures/dataset/imagenette.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    imagenette
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tests/fixtures/dataset/segmentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segmentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_13_13_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../tests/fixtures/models/index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    models
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3_1_13_13_1_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_3_1_13_13_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_13_13_1_2">
            <span class="md-nav__icon md-icon"></span>
            models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tests/fixtures/models/anomaly.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    anomaly
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tests/fixtures/models/classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tests/fixtures/models/segmentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    segmentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tests/helpers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    helpers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../tests/models.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../utils.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../validator.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    validator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../visualization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    visualization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../vit_explainability.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vit_explainability
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/datamodules.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Datamodules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/tasks.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tasks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/configurations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configurations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/devices_setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up devices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/reproducibility.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reproducibility
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/model_management.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/export.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Export models for inference
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/integration.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External projects integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/contribution.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/documentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Building documentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_11" >
        
          <label class="md-nav__link" for="__nav_4_11" id="__nav_4_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_11">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/examples/segmentation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Segmentation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/examples/ssl.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Self-Supervised Learning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/examples/classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pytorch classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/examples/multilabel_classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pytorch multilabel classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/examples/sklearn_classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sklearn classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/examples/sklearn_patch_classification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sklearn patch classification
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tutorials/examples/anomaly_detection.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anomaly Detection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../SUMMARY.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Package Summary
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset" class="md-nav__link">
    dataset
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.InvalidNumWorkersNumberException" class="md-nav__link">
    InvalidNumWorkersNumberException
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.InvalidParameterCombinationException" class="md-nav__link">
    InvalidParameterCombinationException
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.PatchDatasetFileFormat" class="md-nav__link">
    PatchDatasetFileFormat
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.PatchDatasetInfo" class="md-nav__link">
    PatchDatasetInfo
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.__save_patch_dataset" class="md-nav__link">
    __save_patch_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.compute_patch_info" class="md-nav__link">
    compute_patch_info()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.compute_patch_info_from_patch_dim" class="md-nav__link">
    compute_patch_info_from_patch_dim()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.compute_safe_patch_range" class="md-nav__link">
    compute_safe_patch_range()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.create_h5" class="md-nav__link">
    create_h5()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.extract_patches" class="md-nav__link">
    extract_patches()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.from_rgb_to_idx" class="md-nav__link">
    from_rgb_to_idx()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.generate_patch_dataset" class="md-nav__link">
    generate_patch_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.generate_patch_sampling_dataset" class="md-nav__link">
    generate_patch_sampling_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.generate_patch_sliding_window_dataset" class="md-nav__link">
    generate_patch_sliding_window_dataset()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.get_image_mask_association" class="md-nav__link">
    get_image_mask_association()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.load_train_file" class="md-nav__link">
    load_train_file()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.multilabel_stratification" class="md-nav__link">
    multilabel_stratification()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.triangle_area" class="md-nav__link">
    triangle_area()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.triangulate_region" class="md-nav__link">
    triangulate_region()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quadra.utils.patch.dataset.trisample" class="md-nav__link">
    trisample()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>dataset</h1>

<div class="doc doc-object doc-module">



<a id="quadra.utils.patch.dataset"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h3 id="quadra.utils.patch.dataset.InvalidNumWorkersNumberException" class="doc doc-heading">
          <code>InvalidNumWorkersNumberException</code>


<a href="#quadra.utils.patch.dataset.InvalidNumWorkersNumberException" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#Exception">Exception</a></code></p>

  
      <p>Exception raised when an invalid number of workers is passed to a function.</p>


  </div>

</div>

<div class="doc doc-object doc-class">




<h3 id="quadra.utils.patch.dataset.InvalidParameterCombinationException" class="doc doc-heading">
          <code>InvalidParameterCombinationException</code>


<a href="#quadra.utils.patch.dataset.InvalidParameterCombinationException" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/exceptions.html#Exception">Exception</a></code></p>

  
      <p>Exception raised when an invalid combination of parameters is passed to a function.</p>


  </div>

</div>

<div class="doc doc-object doc-class">




<h3 id="quadra.utils.patch.dataset.PatchDatasetFileFormat" class="doc doc-heading">
          <code>PatchDatasetFileFormat</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#quadra.utils.patch.dataset.PatchDatasetFileFormat" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">

  
      <p>Model representing the content of the patch dataset split_files field in the info.json file.</p>


  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h3 id="quadra.utils.patch.dataset.PatchDatasetInfo" class="doc doc-heading">
          <code>PatchDatasetInfo</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#quadra.utils.patch.dataset.PatchDatasetInfo" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">

  
      <p>Model representing the content of the patch dataset info.json file.</p>


  

  <div class="doc doc-children">











  </div>

  </div>

</div>



<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.__save_patch_dataset" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">__save_patch_dataset</span><span class="p">(</span><span class="n">image_patches</span><span class="p">,</span> <span class="n">labelled_patches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask_patches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labelled_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_folder</span><span class="o">=</span><span class="s1">&#39;extraction_data&#39;</span><span class="p">,</span> <span class="n">image_name</span><span class="o">=</span><span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="n">area_threshold</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">area_defect_threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">mask_extension</span><span class="o">=</span><span class="s1">&#39;_mask&#39;</span><span class="p">,</span> <span class="n">save_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mask_output_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_to_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.__save_patch_dataset" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Given a view_as_window computed patches, masks and labelled mask, save all the images in subdirectory
divided by name and position in the grid, ambiguous patches i.e. the one that contains defects but with not enough
to go above defined thresholds are marked as #DISCARD# and should be discarded in training.
Patches of images without ground truth are saved inside the None folder.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>image_patches</b>
            (<code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>)
        –
        <div class="doc-md-description">
          <p>[n, m, patch_w, patch_h, channel] numpy array of the image patches</p>
        </div>
      </li>
      <li class="field-body">
        <b>mask_patches</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>[n, m, patch_w, patch_h] numpy array of mask patches</p>
        </div>
      </li>
      <li class="field-body">
        <b>labelled_patches</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>[n, m, patch_w, patch_h] numpy array of labelled mask patch</p>
        </div>
      </li>
      <li class="field-body">
        <b>labelled_mask</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>numpy array in which each defect in the image is labelled using connected components</p>
        </div>
      </li>
      <li class="field-body">
        <b>class_to_idx</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Dictionary with the mapping {"class" -&gt; class in mask}, it must cover all indices
contained in the masks</p>
        </div>
      </li>
      <li class="field-body">
        <b>save_mask</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                <code>False</code>
)
        –
        <div class="doc-md-description">
          <p>flag to save or ignore mask</p>
        </div>
      </li>
      <li class="field-body">
        <b>output_folder</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                <code>&#39;extraction_data&#39;</code>
)
        –
        <div class="doc-md-description">
          <p>folder where to save data</p>
        </div>
      </li>
      <li class="field-body">
        <b>mask_extension</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                <code>&#39;_mask&#39;</code>
)
        –
        <div class="doc-md-description">
          <p>postfix of the saved mask based on the image name</p>
        </div>
      </li>
      <li class="field-body">
        <b>mask_output_folder</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Optional folder in which to save the masks</p>
        </div>
      </li>
      <li class="field-body">
        <b>image_name</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                <code>&#39;example&#39;</code>
)
        –
        <div class="doc-md-description">
          <p>name to use in order to save the data</p>
        </div>
      </li>
      <li class="field-body">
        <b>area_threshold</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                <code>0.45</code>
)
        –
        <div class="doc-md-description">
          <p>minimum percentage of defected patch area present in the mask to classify the patch as defect</p>
        </div>
      </li>
      <li class="field-body">
        <b>area_defect_threshold</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                <code>0.2</code>
)
        –
        <div class="doc-md-description">
          <p>minimum percentage of single defect present in the patch to classify the patch as defect</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>None</code>
        –
        <div class="doc-md-description">
          <p>None</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__save_patch_dataset</span><span class="p">(</span>
    <span class="n">image_patches</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">labelled_patches</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mask_patches</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labelled_mask</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">output_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;extraction_data&quot;</span><span class="p">,</span>
    <span class="n">image_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
    <span class="n">area_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span>
    <span class="n">area_defect_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">mask_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_mask&quot;</span><span class="p">,</span>
    <span class="n">save_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">mask_output_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">class_to_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given a view_as_window computed patches, masks and labelled mask, save all the images in subdirectory</span>
<span class="sd">    divided by name and position in the grid, ambiguous patches i.e. the one that contains defects but with not enough</span>
<span class="sd">    to go above defined thresholds are marked as #DISCARD# and should be discarded in training.</span>
<span class="sd">    Patches of images without ground truth are saved inside the None folder.</span>

<span class="sd">    Args:</span>
<span class="sd">        image_patches: [n, m, patch_w, patch_h, channel] numpy array of the image patches</span>
<span class="sd">        mask_patches: [n, m, patch_w, patch_h] numpy array of mask patches</span>
<span class="sd">        labelled_patches: [n, m, patch_w, patch_h] numpy array of labelled mask patch</span>
<span class="sd">        labelled_mask: numpy array in which each defect in the image is labelled using connected components</span>
<span class="sd">        class_to_idx: Dictionary with the mapping {&quot;class&quot; -&gt; class in mask}, it must cover all indices</span>
<span class="sd">            contained in the masks</span>
<span class="sd">        save_mask: flag to save or ignore mask</span>
<span class="sd">        output_folder: folder where to save data</span>
<span class="sd">        mask_extension: postfix of the saved mask based on the image name</span>
<span class="sd">        mask_output_folder: Optional folder in which to save the masks</span>
<span class="sd">        image_name: name to use in order to save the data</span>
<span class="sd">        area_threshold: minimum percentage of defected patch area present in the mask to classify the patch as defect</span>
<span class="sd">        area_defect_threshold: minimum percentage of single defect present in the patch to classify the patch as defect</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">class_to_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Classes from dict: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">class_to_idx</span><span class="p">)</span>
        <span class="n">index_to_class</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">class_to_idx</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Inverse class: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">index_to_class</span><span class="p">)</span>
        <span class="n">reference_classes</span> <span class="o">=</span> <span class="n">index_to_class</span>

        <span class="k">if</span> <span class="n">mask_patches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">classes_in_mask</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask_patches</span><span class="p">))</span>
            <span class="n">missing_classes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">classes_in_mask</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">class_to_idx</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_classes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Found index in mask that has no corresponding class </span><span class="si">{</span><span class="n">missing_classes</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mask_patches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reference_classes</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask_patches</span><span class="p">)))}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If no `class_to_idx` is provided, `mask_patches` must be provided&quot;</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Classes from mask: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">reference_classes</span><span class="p">)</span>
    <span class="n">class_to_idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reference_classes</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Final reference classes: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">reference_classes</span><span class="p">)</span>

    <span class="c1"># create subdirectory for the saving data</span>
    <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">reference_classes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mask_output_folder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">mask_output_folder</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cl</span><span class="p">)),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mask_output_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mask_output_folder</span> <span class="o">=</span> <span class="n">output_folder</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mask_output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">mask_output_folder</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Mask out: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">mask_output_folder</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mask_patches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="kc">None</span><span class="p">)),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># for [i, j] in patches location</span>
    <span class="k">for</span> <span class="n">row_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image_patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">col_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">image_patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="c1"># default class it&#39;s the one in index 0</span>
            <span class="n">output_class</span> <span class="o">=</span> <span class="n">reference_classes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image_patches</span><span class="p">[</span><span class="n">row_index</span><span class="p">,</span> <span class="n">col_index</span><span class="p">]</span>

            <span class="n">discard_in_training</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">mask_patches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">labelled_patches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">discard_in_training</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">max_defected_area</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask_patches</span><span class="p">[</span><span class="n">row_index</span><span class="p">,</span> <span class="n">col_index</span><span class="p">]</span>
                <span class="n">patch_area_th</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">area_threshold</span>

                <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">discard_in_training</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">class_to_idx</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="n">mask_patch</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                        <span class="n">defected_area</span> <span class="o">=</span> <span class="n">mask_patch</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                        <span class="k">if</span> <span class="n">defected_area</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1"># If enough defected area is inside the patch</span>
                            <span class="k">if</span> <span class="n">defected_area</span> <span class="o">&gt;</span> <span class="n">patch_area_th</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">defected_area</span> <span class="o">&gt;</span> <span class="n">max_defected_area</span><span class="p">:</span>
                                    <span class="n">output_class</span> <span class="o">=</span> <span class="n">k</span>
                                    <span class="n">max_defected_area</span> <span class="o">=</span> <span class="n">defected_area</span>
                                    <span class="n">discard_in_training</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">all_defects_in_patch</span> <span class="o">=</span> <span class="n">mask_patch</span> <span class="o">*</span> <span class="n">labelled_patches</span><span class="p">[</span><span class="n">row_index</span><span class="p">,</span> <span class="n">col_index</span><span class="p">]</span>

                                <span class="c1"># For each different defect inside the area check</span>
                                <span class="c1"># if enough part of it is contained in the patch</span>
                                <span class="k">for</span> <span class="n">defect_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_defects_in_patch</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="n">defect_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                        <span class="k">continue</span>

                                    <span class="n">defect_area_in_patch</span> <span class="o">=</span> <span class="p">(</span><span class="n">all_defects_in_patch</span> <span class="o">==</span> <span class="n">defect_id</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                                    <span class="n">defect_area_th</span> <span class="o">=</span> <span class="p">(</span><span class="n">labelled_mask</span> <span class="o">==</span> <span class="n">defect_id</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="n">area_defect_threshold</span>

                                    <span class="k">if</span> <span class="n">defect_area_in_patch</span> <span class="o">&gt;</span> <span class="n">defect_area_th</span><span class="p">:</span>
                                        <span class="n">output_class</span> <span class="o">=</span> <span class="n">k</span>
                                        <span class="k">if</span> <span class="n">defect_area_in_patch</span> <span class="o">&gt;</span> <span class="n">max_defected_area</span><span class="p">:</span>
                                            <span class="n">max_defected_area</span> <span class="o">=</span> <span class="n">defect_area_in_patch</span>
                                            <span class="n">discard_in_training</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">discard_in_training</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">save_mask</span><span class="p">:</span>
                    <span class="n">mask_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">row_index</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">image_patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">col_index</span><span class="si">}{</span><span class="n">mask_extension</span><span class="si">}</span><span class="s2">.png&quot;</span>

                    <span class="k">if</span> <span class="n">discard_in_training</span><span class="p">:</span>
                        <span class="n">mask_name</span> <span class="o">=</span> <span class="s2">&quot;#DISCARD#&quot;</span> <span class="o">+</span> <span class="n">mask_name</span>
                    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">mask_output_folder</span><span class="p">,</span>
                            <span class="n">output_class</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
                            <span class="n">mask_name</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">output_class</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>

            <span class="n">patch_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">row_index</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">image_patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">col_index</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="k">if</span> <span class="n">discard_in_training</span><span class="p">:</span>
                <span class="n">patch_name</span> <span class="o">=</span> <span class="s2">&quot;#DISCARD#&quot;</span> <span class="o">+</span> <span class="n">patch_name</span>

            <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">output_folder</span><span class="p">,</span>
                    <span class="n">output_class</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
                    <span class="n">patch_name</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">image</span><span class="p">,</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.compute_patch_info" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">compute_patch_info</span><span class="p">(</span><span class="n">img_h</span><span class="p">,</span> <span class="n">img_w</span><span class="p">,</span> <span class="n">patch_num_h</span><span class="p">,</span> <span class="n">patch_num_w</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.compute_patch_info" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Compute the patch size and step size given the number of patches and the overlap.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>img_h</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        –
        <div class="doc-md-description">
          <p>height of the image</p>
        </div>
      </li>
      <li class="field-body">
        <b>img_w</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        –
        <div class="doc-md-description">
          <p>width of the image</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_num_h</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        –
        <div class="doc-md-description">
          <p>number of vertical patches</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_num_w</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        –
        <div class="doc-md-description">
          <p>number of horizontal patches</p>
        </div>
      </li>
      <li class="field-body">
        <b>overlap</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                <code>0.0</code>
)
        –
        <div class="doc-md-description">
          <p>percentage of overlap between patches.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>], <a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>
        –
        <div class="doc-md-description">
          <p>Tuple containing:
patch_size: [size_y, size_x] Dimension of the patch
step_size: [step_y, step_x]  Step size</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_patch_info</span><span class="p">(</span>
    <span class="n">img_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">img_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">patch_num_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">patch_num_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the patch size and step size given the number of patches and the overlap.</span>

<span class="sd">    Args:</span>
<span class="sd">        img_h: height of the image</span>
<span class="sd">        img_w: width of the image</span>
<span class="sd">        patch_num_h: number of vertical patches</span>
<span class="sd">        patch_num_w: number of horizontal patches</span>
<span class="sd">        overlap: percentage of overlap between patches.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple containing:</span>
<span class="sd">            patch_size: [size_y, size_x] Dimension of the patch</span>
<span class="sd">            step_size: [step_y, step_x]  Step size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">patch_size_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">img_h</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">patch_num_h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">patch_num_h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">overlap</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">step_h</span> <span class="o">=</span> <span class="n">patch_size_h</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">overlap</span> <span class="o">*</span> <span class="n">patch_size_h</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">patch_size_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">img_w</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">patch_num_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">patch_num_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">overlap</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">step_w</span> <span class="o">=</span> <span class="n">patch_size_w</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">overlap</span> <span class="o">*</span> <span class="n">patch_size_w</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># We want a combination of patch size and step that if the image is not divisible by the number of patches</span>
    <span class="c1"># will try to fit the maximum number of patches in the image + ONLY 1 extra patch that will be taken from the end</span>
    <span class="c1"># of the image.</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">original_patch_size_h</span> <span class="o">=</span> <span class="n">patch_size_h</span>
    <span class="n">original_patch_size_w</span> <span class="o">=</span> <span class="n">patch_size_w</span>
    <span class="n">original_step_h</span> <span class="o">=</span> <span class="n">step_h</span>
    <span class="n">original_step_w</span> <span class="o">=</span> <span class="n">step_w</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">patch_num_h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step_h</span> <span class="o">+</span> <span class="n">patch_size_h</span> <span class="o">&lt;</span> <span class="n">img_h</span> <span class="ow">or</span> <span class="p">(</span><span class="n">patch_num_h</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">step_h</span> <span class="o">+</span> <span class="n">patch_size_h</span> <span class="o">&gt;</span> <span class="n">img_h</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">patch_num_h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">step_h</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">patch_size_h</span> <span class="o">&lt;</span> <span class="n">img_h</span><span class="p">:</span>
            <span class="n">step_h</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">patch_size_h</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
            <span class="c1"># We probably entered an infinite loop, restart with smaller step size</span>
            <span class="n">step_h</span> <span class="o">=</span> <span class="n">original_step_h</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">patch_size_h</span> <span class="o">=</span> <span class="n">original_patch_size_h</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">patch_num_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step_w</span> <span class="o">+</span> <span class="n">patch_size_w</span> <span class="o">&lt;</span> <span class="n">img_w</span> <span class="ow">or</span> <span class="p">(</span><span class="n">patch_num_w</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">step_w</span> <span class="o">+</span> <span class="n">patch_size_w</span> <span class="o">&gt;</span> <span class="n">img_w</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">patch_num_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">step_w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">patch_size_w</span> <span class="o">&lt;</span> <span class="n">img_w</span><span class="p">:</span>
            <span class="n">step_w</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">patch_size_w</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
            <span class="c1"># We probably entered an infinite loop, restart with smaller step size</span>
            <span class="n">step_w</span> <span class="o">=</span> <span class="n">original_step_w</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">patch_size_w</span> <span class="o">=</span> <span class="n">original_patch_size_w</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">patch_size_h</span><span class="p">,</span> <span class="n">patch_size_w</span><span class="p">),</span> <span class="p">(</span><span class="n">step_h</span><span class="p">,</span> <span class="n">step_w</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.compute_patch_info_from_patch_dim" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">compute_patch_info_from_patch_dim</span><span class="p">(</span><span class="n">img_h</span><span class="p">,</span> <span class="n">img_w</span><span class="p">,</span> <span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.compute_patch_info_from_patch_dim" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Compute patch info given the patch dimension
Args:
    img_h: height of the image
    img_w: width of the image
    patch_height: patch height
    patch_width: patch width
    overlap: overlap percentage [0, 1].</p>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>], <a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>
        –
        <div class="doc-md-description">
          <p>Tuple of number of patches, step</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_patch_info_from_patch_dim</span><span class="p">(</span>
    <span class="n">img_h</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">img_w</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">patch_height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">patch_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute patch info given the patch dimension</span>
<span class="sd">    Args:</span>
<span class="sd">        img_h: height of the image</span>
<span class="sd">        img_w: width of the image</span>
<span class="sd">        patch_height: patch height</span>
<span class="sd">        patch_width: patch width</span>
<span class="sd">        overlap: overlap percentage [0, 1].</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple of number of patches, step</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">overlap</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Invalid overlap. Must be between [0, 1], received </span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">step_h</span> <span class="o">=</span> <span class="n">patch_height</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">overlap</span> <span class="o">*</span> <span class="n">patch_height</span><span class="p">)</span>
    <span class="n">step_w</span> <span class="o">=</span> <span class="n">patch_width</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">overlap</span> <span class="o">*</span> <span class="n">patch_width</span><span class="p">)</span>

    <span class="n">patch_num_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(((</span><span class="n">img_h</span> <span class="o">-</span> <span class="n">patch_height</span><span class="p">)</span> <span class="o">/</span> <span class="n">step_h</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">patch_num_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(((</span><span class="n">img_w</span> <span class="o">-</span> <span class="n">patch_width</span><span class="p">)</span> <span class="o">/</span> <span class="n">step_w</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Handle the case where the last patch does not cover the full image, I need to do this rather than np.ceil</span>
    <span class="c1"># because I don&#39;t want to add a new patch if the last one exceeds already the image!</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">patch_num_h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step_h</span><span class="p">)</span> <span class="o">+</span> <span class="n">patch_height</span> <span class="o">&lt;</span> <span class="n">img_h</span><span class="p">:</span>
        <span class="n">patch_num_h</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">patch_num_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step_w</span><span class="p">)</span> <span class="o">+</span> <span class="n">patch_width</span> <span class="o">&lt;</span> <span class="n">img_w</span><span class="p">:</span>
        <span class="n">patch_num_w</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">patch_num_h</span><span class="p">,</span> <span class="n">patch_num_w</span><span class="p">),</span> <span class="p">(</span><span class="n">step_h</span><span class="p">,</span> <span class="n">step_w</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.compute_safe_patch_range" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">compute_safe_patch_range</span><span class="p">(</span><span class="n">sampled_point</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">image_size</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.compute_safe_patch_range" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Computes the safe patch size for the given image size.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>sampled_point</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        –
        <div class="doc-md-description">
          <p>the sampled point</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_size</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        –
        <div class="doc-md-description">
          <p>the size of the patch</p>
        </div>
      </li>
      <li class="field-body">
        <b>image_size</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        –
        <div class="doc-md-description">
          <p>the size of the image.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
        –
        <div class="doc-md-description">
          <p>Tuple containing the safe patch range [left, right] such that</p>
      </div>
      </li>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
        –
        <div class="doc-md-description">
          <p>[sampled_point - left : sampled_point + right] will be within the image size.</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_safe_patch_range</span><span class="p">(</span><span class="n">sampled_point</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">image_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the safe patch size for the given image size.</span>

<span class="sd">    Args:</span>
<span class="sd">        sampled_point: the sampled point</span>
<span class="sd">        patch_size: the size of the patch</span>
<span class="sd">        image_size: the size of the image.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple containing the safe patch range [left, right] such that</span>
<span class="sd">        [sampled_point - left : sampled_point + right] will be within the image size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">patch_size</span> <span class="o">//</span> <span class="mi">2</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">patch_size</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">sampled_point</span> <span class="o">+</span> <span class="n">right</span> <span class="o">&gt;</span> <span class="n">image_size</span><span class="p">:</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">image_size</span> <span class="o">-</span> <span class="n">sampled_point</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">patch_size</span> <span class="o">-</span> <span class="n">right</span>

    <span class="k">if</span> <span class="n">sampled_point</span> <span class="o">-</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">sampled_point</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">patch_size</span> <span class="o">-</span> <span class="n">left</span>

    <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.create_h5" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">create_h5</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">,</span> <span class="n">idx_to_class</span><span class="p">,</span> <span class="n">overlap</span><span class="p">,</span> <span class="n">repeat_good_images</span><span class="p">,</span> <span class="n">balance_defects</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">,</span> <span class="n">labelled_masks_path</span><span class="p">,</span> <span class="n">sampling_dataset_folder</span><span class="p">,</span> <span class="n">annotated_good</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patch_number</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.create_h5" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Create h5 files for each image in the dataset.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>data_dictionary</b>
            (<code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code>)
        –
        <div class="doc-md-description">
          <p>Dictionary containing image and mask mapping</p>
        </div>
      </li>
      <li class="field-body">
        <b>idx_to_class</b>
            (<code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code>)
        –
        <div class="doc-md-description">
          <p>Dict mapping an index to the corresponding class name</p>
        </div>
      </li>
      <li class="field-body">
        <b>overlap</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        –
        <div class="doc-md-description">
          <p>Percentage of overlap between patches</p>
        </div>
      </li>
      <li class="field-body">
        <b>repeat_good_images</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        –
        <div class="doc-md-description">
          <p>Number of repetition for images with emtpy or None mask</p>
        </div>
      </li>
      <li class="field-body">
        <b>balance_defects</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>)
        –
        <div class="doc-md-description">
          <p>If true add one good entry for each defect extracted</p>
        </div>
      </li>
      <li class="field-body">
        <b>output_folder</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        –
        <div class="doc-md-description">
          <p>root folder</p>
        </div>
      </li>
      <li class="field-body">
        <b>overlap</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        –
        <div class="doc-md-description">
          <p>Percentage of overlap between patches</p>
        </div>
      </li>
      <li class="field-body">
        <b>annotated_good</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>List of class indices that are considered good other than the background</p>
        </div>
      </li>
      <li class="field-body">
        <b>labelled_masks_path</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        –
        <div class="doc-md-description">
          <p>paths of labelled masks</p>
        </div>
      </li>
      <li class="field-body">
        <b>sampling_dataset_folder</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        –
        <div class="doc-md-description">
          <p>folder of the dataset</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_size</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Dimension of the patch, required if patch_number is None</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_number</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Number of patches for each side, required if patch_size is None.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
<b>output_list</b> (            <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>
)        –
        <div class="doc-md-description">
          <p>List of h5 files' names</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_h5</span><span class="p">(</span>
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">idx_to_class</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">repeat_good_images</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">balance_defects</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">output_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">labelled_masks_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sampling_dataset_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">annotated_good</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">patch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">patch_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create h5 files for each image in the dataset.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_dictionary: Dictionary containing image and mask mapping</span>
<span class="sd">        idx_to_class: Dict mapping an index to the corresponding class name</span>
<span class="sd">        overlap: Percentage of overlap between patches</span>
<span class="sd">        repeat_good_images: Number of repetition for images with emtpy or None mask</span>
<span class="sd">        balance_defects: If true add one good entry for each defect extracted</span>
<span class="sd">        output_folder: root folder</span>
<span class="sd">        overlap: Percentage of overlap between patches</span>
<span class="sd">        annotated_good: List of class indices that are considered good other than the background</span>
<span class="sd">        labelled_masks_path: paths of labelled masks</span>
<span class="sd">        sampling_dataset_folder: folder of the dataset</span>
<span class="sd">        patch_size: Dimension of the patch, required if patch_number is None</span>
<span class="sd">        patch_number: Number of patches for each side, required if patch_size is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        output_list: List of h5 files&#39; names</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">patch_number</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">patch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidParameterCombinationException</span><span class="p">(</span><span class="s2">&quot;One between patch number or patch size must be specified!&quot;</span><span class="p">)</span>

    <span class="n">output_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">])</span>
        <span class="c1"># this works even if item[&quot;path&quot;] is already an absolute path</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]))</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># this works even if item[&quot;mask&quot;] is already an absolute path</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">patch_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">patch_height</span> <span class="o">=</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">patch_width</span> <span class="o">=</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Mypy complains because patch_number is Optional, but we already checked that it is not None.</span>
            <span class="p">[</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="n">compute_patch_info</span><span class="p">(</span>
                <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">patch_number</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">patch_number</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">overlap</span>  <span class="c1"># type: ignore[index]</span>
            <span class="p">)</span>

        <span class="n">h5_file_name_good</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sampling_dataset_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;base_name&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_good.h5&quot;</span><span class="p">)</span>

        <span class="n">disable_good</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5_file_name_good</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;img_path&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
            <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;patch_size&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">]))</span>

            <span class="n">target</span> <span class="o">=</span> <span class="n">idx_to_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;triangles&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;triangles_weights&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat_good_images</span><span class="p">):</span>
                    <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">h5_file_name_good</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">continue</span>

            <span class="n">binary_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

            <span class="c1"># Dilate the defects and take the background</span>
            <span class="n">binary_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">binary_mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">])))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

            <span class="n">temp_binary_mask</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">binary_mask</span><span class="p">)</span>
            <span class="c1"># Remove the edges of the image as they are unsafe for sampling without padding</span>
            <span class="n">temp_binary_mask</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">patch_height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">temp_binary_mask</span><span class="p">[:,</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">patch_width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">temp_binary_mask</span><span class="p">[</span><span class="o">-</span><span class="n">patch_height</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">temp_binary_mask</span><span class="p">[:,</span> <span class="o">-</span><span class="n">patch_width</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">temp_binary_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># If the mask without the edges is not empty use it, otherwise use the original mask as it is not</span>
                <span class="c1"># possible to sample a patch that will not exceed the edges, this must be taken care by the patch</span>
                <span class="c1"># sampler used during training</span>
                <span class="n">binary_mask</span> <span class="o">=</span> <span class="n">temp_binary_mask</span>

            <span class="c1"># In the case of hx1 or 1xw number of patches we must make sure that the sampling row or the sampling</span>
            <span class="c1"># column is empty, if it isn&#39;t remove it from the possible sampling area</span>
            <span class="k">if</span> <span class="n">patch_height</span> <span class="o">==</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">must_clear_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">binary_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">binary_mask</span><span class="p">[:,</span> <span class="n">must_clear_indices</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">patch_width</span> <span class="o">==</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">must_clear_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">binary_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">binary_mask</span><span class="p">[</span><span class="n">must_clear_indices</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># If there&#39;s no space for sampling good patches skip it</span>
            <span class="k">if</span> <span class="n">binary_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">disable_good</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">triangles</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">triangulate_region</span><span class="p">(</span><span class="n">binary_mask</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">triangles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">disable_good</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;Saving </span><span class="si">%s</span><span class="s2"> triangles for </span><span class="si">%s</span><span class="s2"> with label </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">triangles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">h5_file_name_good</span><span class="p">),</span>
                        <span class="n">target</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask_path&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>
                    <span class="c1"># Points from extracted triangles should be sufficiently far from all the defects allowing to sample</span>
                    <span class="c1"># good patches almost all the time</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;triangles&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">triangles</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;triangles_weights&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

                    <span class="c1"># Avoid saving the good h5 file here because otherwise I&#39;ll have one more good compared to the</span>
                    <span class="c1"># number of defects</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">balance_defects</span><span class="p">:</span>
                        <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">h5_file_name_good</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">disable_good</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">h5_file_name_good</span><span class="p">)</span>

        <span class="n">labelled_mask</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labelled_masks_path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;base_name&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">),</span> <span class="n">labelled_mask</span><span class="p">)</span>

        <span class="n">real_defects_mask</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">annotated_good</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Remove true defected area from the good labeled mask</span>
            <span class="c1"># If we want this to be even more restrictive we could also include the background as we don&#39;t know for sure</span>
            <span class="c1"># it will not contain any defects</span>
            <span class="n">real_defects_mask</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">annotated_good</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="n">real_defects_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">real_defects_mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">]))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">labelled_mask</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">current_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">labelled_mask</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="n">target_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">mask</span> <span class="o">*</span> <span class="n">current_mask</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="c1"># When we have good annotations we want to avoid sampling patches containing true defects, to do so we</span>
            <span class="c1"># reduce the extraction area based on the area covered by the other defects</span>
            <span class="k">if</span> <span class="n">annotated_good</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">real_defects_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">target_idx</span> <span class="ow">in</span> <span class="n">annotated_good</span><span class="p">:</span>
                <span class="c1"># a - b = a &amp; ~b</span>
                <span class="c1"># pylint: disable=invalid-unary-operand-type</span>
                <span class="n">current_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">current_mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="o">~</span><span class="n">real_defects_mask</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># When dealing with small defects the number of points that will be sampled will be limited and patches</span>
                <span class="c1"># will mostly be centered around the defect, to overcome this issue enlarge defect bounding box by 50%</span>
                <span class="c1"># of the difference between the patch_size and the defect bb size, we don&#39;t do this on good labels to</span>
                <span class="c1"># avoid invalidating the reduction applied before.</span>
                <span class="n">props</span> <span class="o">=</span> <span class="n">regionprops</span><span class="p">(</span><span class="n">current_mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">bbox_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">props</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">props</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">props</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">props</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">diff_bbox</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">patch_height</span> <span class="o">-</span> <span class="n">bbox_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">patch_width</span> <span class="o">-</span> <span class="n">bbox_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>

                <span class="k">if</span> <span class="n">diff_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">current_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">current_mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">diff_bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">diff_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">current_mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">dilate</span><span class="p">(</span><span class="n">current_mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">diff_bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">current_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># If it&#39;s not possible to sample a labelled good patch basically</span>
                <span class="k">continue</span>

            <span class="n">temp_current_mask</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">current_mask</span><span class="p">)</span>
            <span class="c1"># Remove the edges of the image as they are unsafe for sampling without padding</span>
            <span class="n">temp_current_mask</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">patch_height</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">temp_current_mask</span><span class="p">[:,</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">patch_width</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">temp_current_mask</span><span class="p">[</span><span class="o">-</span><span class="n">patch_height</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">temp_current_mask</span><span class="p">[:,</span> <span class="o">-</span><span class="n">patch_width</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">temp_current_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># If the mask without the edges is not empty use it, otherwise use the original mask as it is not</span>
                <span class="c1"># possible to sample a patch that will not exceed the edges, this must be taken care by the patch</span>
                <span class="c1"># sampler used during training</span>
                <span class="n">current_mask</span> <span class="o">=</span> <span class="n">temp_current_mask</span>

            <span class="n">triangles</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">triangulate_region</span><span class="p">(</span><span class="n">current_mask</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">triangles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">h5_file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sampling_dataset_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;base_name&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>

                <span class="n">target</span> <span class="o">=</span> <span class="n">idx_to_class</span><span class="p">[</span><span class="n">target_idx</span><span class="p">]</span>

                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Saving </span><span class="si">%s</span><span class="s2"> triangles for </span><span class="si">%s</span><span class="s2"> with label </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">triangles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">h5_file_name</span><span class="p">),</span>
                    <span class="n">target</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">h5_file_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;img_path&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;mask_path&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;patch_size&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">]))</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;triangles&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">triangles</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;triangles_weights&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;labelled_index&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">annotated_good</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">target_idx</span> <span class="ow">in</span> <span class="n">annotated_good</span><span class="p">:</span>
                    <span class="c1"># I treat annotate good images exactly the same as I would treat background</span>
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat_good_images</span><span class="p">):</span>
                        <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">h5_file_name</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">h5_file_name</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">balance_defects</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">disable_good</span><span class="p">:</span>
                        <span class="n">output_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">h5_file_name_good</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">idx_to_class</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s2">&quot;Unable to add a good defect for </span><span class="si">%s</span><span class="s2">, since there&#39;s no way to sample good patches&quot;</span><span class="p">,</span>
                            <span class="n">h5_file_name</span><span class="p">,</span>
                        <span class="p">)</span>
    <span class="k">return</span> <span class="n">output_list</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.extract_patches" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">extract_patches</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">patch_number</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">overlap</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.extract_patches" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>From an image extract N x M Patch[h, w] if the image is not perfectly divided by the number of patches of given
dimension the last patch will contain a replica of the original image taken in range [-img_h:, :] or [:, -img_w:].</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>image</b>
            (<code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>)
        –
        <div class="doc-md-description">
          <p>Numpy array of the image</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_number</b>
            (<code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, ...]</code>)
        –
        <div class="doc-md-description">
          <p>number of patches to be extracted</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_size</b>
            (<code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, ...]</code>)
        –
        <div class="doc-md-description">
          <p>dimension of the patch</p>
        </div>
      </li>
      <li class="field-body">
        <b>step</b>
            (<code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, ...]</code>)
        –
        <div class="doc-md-description">
          <p>step of the patch extraction</p>
        </div>
      </li>
      <li class="field-body">
        <b>overlap</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        –
        <div class="doc-md-description">
          <p>horizontal and vertical patch overlapping in range [0, 1]</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
        –
        <div class="doc-md-description">
          <p>Patches [N, M, 1, image_w, image_h, image_c]</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_patches</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">patch_number</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">patch_size</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">step</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;From an image extract N x M Patch[h, w] if the image is not perfectly divided by the number of patches of given</span>
<span class="sd">    dimension the last patch will contain a replica of the original image taken in range [-img_h:, :] or [:, -img_w:].</span>

<span class="sd">    Args:</span>
<span class="sd">        image: Numpy array of the image</span>
<span class="sd">        patch_number: number of patches to be extracted</span>
<span class="sd">        patch_size: dimension of the patch</span>
<span class="sd">        step: step of the patch extraction</span>
<span class="sd">        overlap: horizontal and vertical patch overlapping in range [0, 1]</span>

<span class="sd">    Returns:</span>
<span class="sd">        Patches [N, M, 1, image_w, image_h, image_c]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="mf">1.0</span> <span class="o">&gt;=</span> <span class="n">overlap</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Overlap must be between 0 and 1. Received </span><span class="si">{</span><span class="n">overlap</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">(</span><span class="n">patch_num_h</span><span class="p">,</span> <span class="n">patch_num_w</span><span class="p">)</span> <span class="o">=</span> <span class="n">patch_number</span>
    <span class="p">(</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">)</span> <span class="o">=</span> <span class="n">patch_size</span>

    <span class="n">pad_h</span> <span class="o">=</span> <span class="p">(</span><span class="n">patch_num_h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">pad_w</span> <span class="o">=</span> <span class="p">(</span><span class="n">patch_num_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># if the image has 3 channel change dimension</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">patch_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">patch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">step</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">step</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="c1"># If this is not true there&#39;s some strange case I didn&#39;t take into account</span>
    <span class="k">if</span> <span class="n">pad_h</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pad_w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Something went wrong with the patch extraction, expected positive padding values&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pad_h</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">pad_w</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># We work with copies as view_as_windows returns a view of the original image</span>
        <span class="n">crop_img</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pad_h</span><span class="p">:</span>
            <span class="n">crop_img</span> <span class="o">=</span> <span class="n">crop_img</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="p">(</span><span class="n">patch_num_h</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">patch_height</span><span class="p">,</span> <span class="p">:]</span>

        <span class="k">if</span> <span class="n">pad_w</span><span class="p">:</span>
            <span class="n">crop_img</span> <span class="o">=</span> <span class="n">crop_img</span><span class="p">[:,</span> <span class="mi">0</span> <span class="p">:</span> <span class="p">(</span><span class="n">patch_num_w</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">patch_width</span><span class="p">]</span>

        <span class="c1"># Extract safe patches inside the image</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="n">view_as_windows</span><span class="p">(</span><span class="n">crop_img</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="n">view_as_windows</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>

    <span class="n">extra_patches_h</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">extra_patches_w</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">pad_h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Append extra patches taken from the edge of the image</span>
        <span class="n">extra_patches_h</span> <span class="o">=</span> <span class="n">view_as_windows</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="o">-</span><span class="n">patch_height</span><span class="p">:,</span> <span class="p">:],</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pad_w</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">extra_patches_w</span> <span class="o">=</span> <span class="n">view_as_windows</span><span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="o">-</span><span class="n">patch_width</span><span class="p">:],</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">extra_patches_h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Add an extra column and set is content to the bottom right patch area of the original image if both</span>
            <span class="c1"># dimension requires extra patches</span>
            <span class="k">if</span> <span class="n">extra_patches_h</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
                <span class="c1"># RGB</span>
                <span class="n">extra_patches_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">extra_patches_h</span><span class="p">,</span>
                        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">extra_patches_h</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)),</span>
                    <span class="p">],</span>
                    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">extra_patches_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">extra_patches_h</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">patch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">))],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">extra_patches_h</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Required by mypy as it cannot infer that extra_patch_h cannot be None</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Extra patch h cannot be None!&quot;</span><span class="p">)</span>

            <span class="n">extra_patches_h</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">-</span><span class="n">patch_height</span><span class="p">:,</span> <span class="o">-</span><span class="n">patch_width</span><span class="p">:]</span>

    <span class="k">if</span> <span class="n">patches</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="c1"># With RGB images there&#39;s an extra dimension, axis 2 is important don&#39;t use plain squeeze or it breaks if</span>
        <span class="c1"># the number of patches is set to 1!</span>
        <span class="n">patches</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">extra_patches_w</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">extra_patches_w</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="c1"># RGB</span>
            <span class="n">patches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">patches</span><span class="p">,</span> <span class="n">extra_patches_w</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">patches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">patches</span><span class="p">,</span> <span class="n">extra_patches_w</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">extra_patches_h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">extra_patches_h</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="c1"># RGB</span>
            <span class="n">patches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">patches</span><span class="p">,</span> <span class="n">extra_patches_h</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">2</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">patches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">patches</span><span class="p">,</span> <span class="n">extra_patches_h</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># If this is not true there&#39;s some strange case I didn&#39;t take into account</span>
    <span class="k">assert</span> <span class="p">(</span>
        <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">patch_num_h</span> <span class="ow">and</span> <span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">patch_num_w</span>
    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Patch shape </span><span class="si">{</span><span class="n">patches</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> does not match the expected shape </span><span class="si">{</span><span class="n">patch_number</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">patches</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.from_rgb_to_idx" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">from_rgb_to_idx</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">class_to_color</span><span class="p">,</span> <span class="n">class_to_idx</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.from_rgb_to_idx" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>img</b>
            (<code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>)
        –
        <div class="doc-md-description">
          <p>Rgb mask in which each different color is associated with a class</p>
        </div>
      </li>
      <li class="field-body">
        <b>class_to_color</b>
            (<code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code>)
        –
        <div class="doc-md-description">
          <p>Dict "key": [R, G, B]</p>
        </div>
      </li>
      <li class="field-body">
        <b>class_to_idx</b>
            (<code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code>)
        –
        <div class="doc-md-description">
          <p>Dict "key": class_idx.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
        –
        <div class="doc-md-description">
          <p>Grayscale mask in which each class is associated with a specific index</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">from_rgb_to_idx</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">class_to_color</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">class_to_idx</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Args:</span>
<span class="sd">        img: Rgb mask in which each different color is associated with a class</span>
<span class="sd">        class_to_color: Dict &quot;key&quot;: [R, G, B]</span>
<span class="sd">        class_to_idx: Dict &quot;key&quot;: class_idx.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Grayscale mask in which each class is associated with a specific index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="c1"># Use negative values to avoid strange behaviour in the remote eventuality</span>
    <span class="c1"># of someone using a color like [1, 255, 255]</span>
    <span class="k">for</span> <span class="n">classe</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">class_to_color</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">img</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">img</span> <span class="o">==</span> <span class="n">color</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">class_to_idx</span><span class="p">[</span><span class="n">classe</span><span class="p">]</span>

    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.generate_patch_dataset" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_patch_dataset</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">,</span> <span class="n">class_to_idx</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">patch_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">output_folder</span><span class="o">=</span><span class="s1">&#39;extraction_data&#39;</span><span class="p">,</span> <span class="n">save_original_images_and_masks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">area_threshold</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">area_defect_threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">mask_extension</span><span class="o">=</span><span class="s1">&#39;_mask&#39;</span><span class="p">,</span> <span class="n">mask_output_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clear_output_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mask_preprocessing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">train_filename</span><span class="o">=</span><span class="s1">&#39;dataset.txt&#39;</span><span class="p">,</span> <span class="n">repeat_good_images</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">balance_defects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">annotated_good</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.generate_patch_dataset" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Giving a data_dictionary as:</p>
<blockquote>
<blockquote>
<blockquote>
<p>{
    'base_name': '163931_1_5.jpg',
    'path': 'extraction_data/1/163931_1_5.jpg',
    'mask': 'extraction_data/1/163931_1_5_mask.jpg'
}
This function will generate patches datasets based on the defined split number, one for training, one for validation
and one for testing respectively under output_folder/train, output_folder/val and output_folder/test, the training
dataset will contain h5 files and a txt file resulting from a call to the
generate_classification_patch_train_dataset, while the test dataset will contain patches saved on disk divided
in subfolders per class, patch extraction is done in a sliding window fashion.
Original images and masks (preprocessed if mask_preprocessing is present) will also be saved under
output_folder/original/images and output_folder/original/masks.
If patch number is specified the patch size will be calculated accordingly, if the image is not divisible by the
patch number two possible behaviours can occur:
    - if the patch reconstruction is smaller than the original image a new patch will be generated containing the
    pixels from the edge of the image (E.g the new patch will contain the last patch_size pixels of the original
    image)
    - if the patch reconstruction is bigger than the original image the last patch will contain the pixels from the
    edge of the image same as above, but without adding a new patch to the count.</p>
</blockquote>
</blockquote>
</blockquote>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>data_dictionary</b>
            (<code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>]</code>)
        –
        <div class="doc-md-description">
          <p>Dictionary as above</p>
        </div>
      </li>
      <li class="field-body">
        <b>val_size</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                <code>0.3</code>
)
        –
        <div class="doc-md-description">
          <p>percentage of the dictionary entries to be used for validation</p>
        </div>
      </li>
      <li class="field-body">
        <b>test_size</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                <code>0.0</code>
)
        –
        <div class="doc-md-description">
          <p>percentage of the dictionary entries to be used for testing</p>
        </div>
      </li>
      <li class="field-body">
        <b>seed</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                <code>42</code>
)
        –
        <div class="doc-md-description">
          <p>seed for rng based operations</p>
        </div>
      </li>
      <li class="field-body">
        <b>clear_output_folder</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                <code>False</code>
)
        –
        <div class="doc-md-description">
          <p>flag used to delete all the data in subfolder</p>
        </div>
      </li>
      <li class="field-body">
        <b>class_to_idx</b>
            (<code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code>)
        –
        <div class="doc-md-description">
          <p>Dictionary {"defect": value in mask.. }</p>
        </div>
      </li>
      <li class="field-body">
        <b>output_folder</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                <code>&#39;extraction_data&#39;</code>
)
        –
        <div class="doc-md-description">
          <p>root_folder where to extract the data</p>
        </div>
      </li>
      <li class="field-body">
        <b>save_original_images_and_masks</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                <code>True</code>
)
        –
        <div class="doc-md-description">
          <p>If True, images and masks will be copied inside output_folder/original/</p>
        </div>
      </li>
      <li class="field-body">
        <b>area_threshold</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                <code>0.45</code>
)
        –
        <div class="doc-md-description">
          <p>Minimum percentage of defected patch area present in the mask to classify the patch as defect</p>
        </div>
      </li>
      <li class="field-body">
        <b>area_defect_threshold</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                <code>0.2</code>
)
        –
        <div class="doc-md-description">
          <p>Minimum percentage of single defect present in the patch to classify the patch as defect</p>
        </div>
      </li>
      <li class="field-body">
        <b>mask_extension</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                <code>&#39;_mask&#39;</code>
)
        –
        <div class="doc-md-description">
          <p>Extension used to assign image to mask</p>
        </div>
      </li>
      <li class="field-body">
        <b>mask_output_folder</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Optional folder in which to save the masks</p>
        </div>
      </li>
      <li class="field-body">
        <b>save_mask</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                <code>False</code>
)
        –
        <div class="doc-md-description">
          <p>Flag to save the mask</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_number</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Optional number of patches for each side, required if patch_size is None</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_size</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Optional dimension of the patch, required if patch_number is None</p>
        </div>
      </li>
      <li class="field-body">
        <b>overlap</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                <code>0.0</code>
)
        –
        <div class="doc-md-description">
          <p>Overlap of the patches [0, 1]</p>
        </div>
      </li>
      <li class="field-body">
        <b>mask_preprocessing</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Callable" href="https://docs.python.org/3/library/typing.html#typing.Callable">Callable</a>]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Optional function applied to masks, this can be useful for example to convert an image in
range [0-255] to the required [0-1]</p>
        </div>
      </li>
      <li class="field-body">
        <b>train_filename</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                <code>&#39;dataset.txt&#39;</code>
)
        –
        <div class="doc-md-description">
          <p>Name of the file containing mapping between h5 files and labels for training</p>
        </div>
      </li>
      <li class="field-body">
        <b>repeat_good_images</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                <code>1</code>
)
        –
        <div class="doc-md-description">
          <p>Number of repetition for images with emtpy or None mask</p>
        </div>
      </li>
      <li class="field-body">
        <b>balance_defects</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                <code>True</code>
)
        –
        <div class="doc-md-description">
          <p>If true add one good entry for each defect extracted</p>
        </div>
      </li>
      <li class="field-body">
        <b>annotated_good</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>List of labels that are annotated but considered as good</p>
        </div>
      </li>
      <li class="field-body">
        <b>num_workers</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                <code>1</code>
)
        –
        <div class="doc-md-description">
          <p>Number of workers used for the h5 creation</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>]</code>
        –
        <div class="doc-md-description">
          <p>None if data_dictionary is empty, otherwise return a dictionary containing informations about the dataset</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_patch_dataset</span><span class="p">(</span>
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span>
    <span class="n">class_to_idx</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">val_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
    <span class="n">test_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
    <span class="n">patch_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">patch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">output_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;extraction_data&quot;</span><span class="p">,</span>
    <span class="n">save_original_images_and_masks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">area_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span>
    <span class="n">area_defect_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">mask_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_mask&quot;</span><span class="p">,</span>
    <span class="n">mask_output_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">clear_output_folder</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">mask_preprocessing</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">train_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dataset.txt&quot;</span><span class="p">,</span>
    <span class="n">repeat_good_images</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">balance_defects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">annotated_good</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Giving a data_dictionary as:</span>
<span class="sd">    &gt;&gt;&gt; {</span>
<span class="sd">    &gt;&gt;&gt;     &#39;base_name&#39;: &#39;163931_1_5.jpg&#39;,</span>
<span class="sd">    &gt;&gt;&gt;     &#39;path&#39;: &#39;extraction_data/1/163931_1_5.jpg&#39;,</span>
<span class="sd">    &gt;&gt;&gt;     &#39;mask&#39;: &#39;extraction_data/1/163931_1_5_mask.jpg&#39;</span>
<span class="sd">    &gt;&gt;&gt;}</span>
<span class="sd">    This function will generate patches datasets based on the defined split number, one for training, one for validation</span>
<span class="sd">    and one for testing respectively under output_folder/train, output_folder/val and output_folder/test, the training</span>
<span class="sd">    dataset will contain h5 files and a txt file resulting from a call to the</span>
<span class="sd">    generate_classification_patch_train_dataset, while the test dataset will contain patches saved on disk divided</span>
<span class="sd">    in subfolders per class, patch extraction is done in a sliding window fashion.</span>
<span class="sd">    Original images and masks (preprocessed if mask_preprocessing is present) will also be saved under</span>
<span class="sd">    output_folder/original/images and output_folder/original/masks.</span>
<span class="sd">    If patch number is specified the patch size will be calculated accordingly, if the image is not divisible by the</span>
<span class="sd">    patch number two possible behaviours can occur:</span>
<span class="sd">        - if the patch reconstruction is smaller than the original image a new patch will be generated containing the</span>
<span class="sd">        pixels from the edge of the image (E.g the new patch will contain the last patch_size pixels of the original</span>
<span class="sd">        image)</span>
<span class="sd">        - if the patch reconstruction is bigger than the original image the last patch will contain the pixels from the</span>
<span class="sd">        edge of the image same as above, but without adding a new patch to the count.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_dictionary: Dictionary as above</span>
<span class="sd">        val_size: percentage of the dictionary entries to be used for validation</span>
<span class="sd">        test_size: percentage of the dictionary entries to be used for testing</span>
<span class="sd">        seed: seed for rng based operations</span>
<span class="sd">        clear_output_folder: flag used to delete all the data in subfolder</span>
<span class="sd">        class_to_idx: Dictionary {&quot;defect&quot;: value in mask.. }</span>
<span class="sd">        output_folder: root_folder where to extract the data</span>
<span class="sd">        save_original_images_and_masks: If True, images and masks will be copied inside output_folder/original/</span>
<span class="sd">        area_threshold: Minimum percentage of defected patch area present in the mask to classify the patch as defect</span>
<span class="sd">        area_defect_threshold: Minimum percentage of single defect present in the patch to classify the patch as defect</span>
<span class="sd">        mask_extension: Extension used to assign image to mask</span>
<span class="sd">        mask_output_folder: Optional folder in which to save the masks</span>
<span class="sd">        save_mask: Flag to save the mask</span>
<span class="sd">        patch_number: Optional number of patches for each side, required if patch_size is None</span>
<span class="sd">        patch_size: Optional dimension of the patch, required if patch_number is None</span>
<span class="sd">        overlap: Overlap of the patches [0, 1]</span>
<span class="sd">        mask_preprocessing: Optional function applied to masks, this can be useful for example to convert an image in</span>
<span class="sd">            range [0-255] to the required [0-1]</span>
<span class="sd">        train_filename: Name of the file containing mapping between h5 files and labels for training</span>
<span class="sd">        repeat_good_images: Number of repetition for images with emtpy or None mask</span>
<span class="sd">        balance_defects: If true add one good entry for each defect extracted</span>
<span class="sd">        annotated_good: List of labels that are annotated but considered as good</span>
<span class="sd">        num_workers: Number of workers used for the h5 creation</span>

<span class="sd">    Returns:</span>
<span class="sd">        None if data_dictionary is empty, otherwise return a dictionary containing informations about the dataset</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input data dictionary is empty!&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">val_size</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">test_size</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val_size</span> <span class="o">+</span> <span class="n">test_size</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Validation and Test size must be greater or equal than zero and sum up to maximum 1&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">clear_output_folder</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_folder</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;original&quot;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_original_images_and_masks</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Moving original images and masks to dataset folder...&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;original&quot;</span><span class="p">,</span> <span class="s2">&quot;images&quot;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;original&quot;</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">):</span>
            <span class="n">img_new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;original&quot;</span><span class="p">,</span> <span class="s2">&quot;images&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">])</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">img_new_path</span><span class="p">))</span>
            <span class="n">data_dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">img_new_path</span>

            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">mask_preprocessing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask_preprocessing</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
                <span class="n">mask_new_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;original&quot;</span><span class="p">,</span> <span class="s2">&quot;masks&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">mask_new_path</span><span class="p">),</span> <span class="n">mask</span><span class="p">)</span>
                <span class="n">data_dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_new_path</span>

    <span class="n">shuffled_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">))</span>
    <span class="n">data_dictionary</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_dictionary</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">shuffled_indices</span><span class="p">]</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Performing multilabel stratification...&quot;</span><span class="p">)</span>
    <span class="n">train_data_dictionary</span><span class="p">,</span> <span class="n">val_data_dictionary</span><span class="p">,</span> <span class="n">test_data_dictionary</span> <span class="o">=</span> <span class="n">multilabel_stratification</span><span class="p">(</span>
        <span class="n">output_folder</span><span class="o">=</span><span class="n">output_folder</span><span class="p">,</span>
        <span class="n">data_dictionary</span><span class="o">=</span><span class="n">data_dictionary</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">class_to_idx</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
        <span class="n">val_size</span><span class="o">=</span><span class="n">val_size</span><span class="p">,</span>
        <span class="n">test_size</span><span class="o">=</span><span class="n">test_size</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Train set size: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_data_dictionary</span><span class="p">))</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation set size: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">val_data_dictionary</span><span class="p">))</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Test set size: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_data_dictionary</span><span class="p">))</span>

    <span class="n">idx_to_class</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">class_to_idx</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">dataset_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;patch_size&quot;</span><span class="p">:</span> <span class="n">patch_size</span><span class="p">,</span>
        <span class="s2">&quot;patch_number&quot;</span><span class="p">:</span> <span class="n">patch_number</span><span class="p">,</span>
        <span class="s2">&quot;overlap&quot;</span><span class="p">:</span> <span class="n">overlap</span><span class="p">,</span>
        <span class="s2">&quot;annotated_good&quot;</span><span class="p">:</span> <span class="n">annotated_good</span><span class="p">,</span>
        <span class="s2">&quot;train_files&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;image_path&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span> <span class="s2">&quot;mask_path&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train_data_dictionary</span><span class="p">],</span>
        <span class="s2">&quot;val_files&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;image_path&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span> <span class="s2">&quot;mask_path&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val_data_dictionary</span><span class="p">],</span>
        <span class="s2">&quot;test_files&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;image_path&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span> <span class="s2">&quot;mask_path&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">test_data_dictionary</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;info.json&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dataset_info</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_data_dictionary</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating train set&quot;</span><span class="p">)</span>
        <span class="n">generate_patch_sampling_dataset</span><span class="p">(</span>
            <span class="n">data_dictionary</span><span class="o">=</span><span class="n">train_data_dictionary</span><span class="p">,</span>
            <span class="n">patch_number</span><span class="o">=</span><span class="n">patch_number</span><span class="p">,</span>
            <span class="n">patch_size</span><span class="o">=</span><span class="n">patch_size</span><span class="p">,</span>
            <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
            <span class="n">idx_to_class</span><span class="o">=</span><span class="n">idx_to_class</span><span class="p">,</span>
            <span class="n">balance_defects</span><span class="o">=</span><span class="n">balance_defects</span><span class="p">,</span>
            <span class="n">repeat_good_images</span><span class="o">=</span><span class="n">repeat_good_images</span><span class="p">,</span>
            <span class="n">output_folder</span><span class="o">=</span><span class="n">output_folder</span><span class="p">,</span>
            <span class="n">subfolder_name</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span>
            <span class="n">train_filename</span><span class="o">=</span><span class="n">train_filename</span><span class="p">,</span>
            <span class="n">annotated_good</span><span class="o">=</span><span class="n">annotated_good</span> <span class="k">if</span> <span class="n">annotated_good</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">class_to_idx</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">annotated_good</span><span class="p">],</span>
            <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">phase</span><span class="p">,</span> <span class="n">split_dict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">val_data_dictionary</span><span class="p">,</span> <span class="n">test_data_dictionary</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating </span><span class="si">%s</span><span class="s2"> set&quot;</span><span class="p">,</span> <span class="n">phase</span><span class="p">)</span>
            <span class="n">generate_patch_sliding_window_dataset</span><span class="p">(</span>
                <span class="n">data_dictionary</span><span class="o">=</span><span class="n">split_dict</span><span class="p">,</span>
                <span class="n">patch_number</span><span class="o">=</span><span class="n">patch_number</span><span class="p">,</span>
                <span class="n">patch_size</span><span class="o">=</span><span class="n">patch_size</span><span class="p">,</span>
                <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
                <span class="n">output_folder</span><span class="o">=</span><span class="n">output_folder</span><span class="p">,</span>
                <span class="n">subfolder_name</span><span class="o">=</span><span class="n">phase</span><span class="p">,</span>
                <span class="n">area_threshold</span><span class="o">=</span><span class="n">area_threshold</span><span class="p">,</span>
                <span class="n">area_defect_threshold</span><span class="o">=</span><span class="n">area_defect_threshold</span><span class="p">,</span>
                <span class="n">mask_extension</span><span class="o">=</span><span class="n">mask_extension</span><span class="p">,</span>
                <span class="n">mask_output_folder</span><span class="o">=</span><span class="n">mask_output_folder</span><span class="p">,</span>
                <span class="n">save_mask</span><span class="o">=</span><span class="n">save_mask</span><span class="p">,</span>
                <span class="n">class_to_idx</span><span class="o">=</span><span class="n">class_to_idx</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;All done! Datasets saved to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">dataset_info</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.generate_patch_sampling_dataset" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_patch_sampling_dataset</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">,</span> <span class="n">output_folder</span><span class="p">,</span> <span class="n">idx_to_class</span><span class="p">,</span> <span class="n">overlap</span><span class="p">,</span> <span class="n">repeat_good_images</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">balance_defects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">patch_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subfolder_name</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">train_filename</span><span class="o">=</span><span class="s1">&#39;dataset.txt&#39;</span><span class="p">,</span> <span class="n">annotated_good</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.generate_patch_sampling_dataset" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Generate a dataset of patches.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>data_dictionary</b>
            (<code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>[<a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>, <a class="autorefs autorefs-external" title="typing.Any" href="https://docs.python.org/3/library/typing.html#typing.Any">Any</a>]]</code>)
        –
        <div class="doc-md-description">
          <p>Dictionary containing image and mask mapping</p>
        </div>
      </li>
      <li class="field-body">
        <b>output_folder</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        –
        <div class="doc-md-description">
          <p>root folder</p>
        </div>
      </li>
      <li class="field-body">
        <b>idx_to_class</b>
            (<code><a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a></code>)
        –
        <div class="doc-md-description">
          <p>Dict mapping an index to the corresponding class name</p>
        </div>
      </li>
      <li class="field-body">
        <b>repeat_good_images</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                <code>1</code>
)
        –
        <div class="doc-md-description">
          <p>Number of repetition for images with emtpy or None mask</p>
        </div>
      </li>
      <li class="field-body">
        <b>balance_defects</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                <code>True</code>
)
        –
        <div class="doc-md-description">
          <p>If true add one good entry for each defect extracted</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_number</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Optional number of patches for each side, required if patch_size is None</p>
        </div>
      </li>
      <li class="field-body">
        <b>patch_size</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Optional dimension of the patch, required if patch_number is None</p>
        </div>
      </li>
      <li class="field-body">
        <b>overlap</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        –
        <div class="doc-md-description">
          <p>Percentage of overlap between patches</p>
        </div>
      </li>
      <li class="field-body">
        <b>subfolder_name</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                <code>&#39;train&#39;</code>
)
        –
        <div class="doc-md-description">
          <p>name of the subfolder where to store h5 files for defected images and dataset txt</p>
        </div>
      </li>
      <li class="field-body">
        <b>train_filename</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                <code>&#39;dataset.txt&#39;</code>
)
        –
        <div class="doc-md-description">
          <p>Name of the file in which to store the mappings between h5 files and labels</p>
        </div>
      </li>
      <li class="field-body">
        <b>annotated_good</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>List of class indices that are considered good other than the background</p>
        </div>
      </li>
      <li class="field-body">
        <b>num_workers</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                <code>1</code>
)
        –
        <div class="doc-md-description">
          <p>Number of processes used to create h5 files.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>None</code>
        –
        <div class="doc-md-description">
          <p>Create a txt file containing tuples path,label where path is a pointer to the generated h5 file and label is the
corresponding label</p>
<p>Each generated h5 file contains five fields:
    img_path: Pointer to the location of the original image
    mask_path: Optional pointer to the mask file, is missing if the mask is completely empty or is
    not present
    patch_size: dimension of the patches on the interested image
    triangles: List of triangles that covers the defect
    triangles_weights: Which weight should be given to each triangle for sampling</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_patch_sampling_dataset</span><span class="p">(</span>
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="n">output_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">idx_to_class</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
    <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">repeat_good_images</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">balance_defects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">patch_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">patch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">subfolder_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;train&quot;</span><span class="p">,</span>
    <span class="n">train_filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;dataset.txt&quot;</span><span class="p">,</span>
    <span class="n">annotated_good</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a dataset of patches.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_dictionary: Dictionary containing image and mask mapping</span>
<span class="sd">        output_folder: root folder</span>
<span class="sd">        idx_to_class: Dict mapping an index to the corresponding class name</span>
<span class="sd">        repeat_good_images: Number of repetition for images with emtpy or None mask</span>
<span class="sd">        balance_defects: If true add one good entry for each defect extracted</span>
<span class="sd">        patch_number: Optional number of patches for each side, required if patch_size is None</span>
<span class="sd">        patch_size: Optional dimension of the patch, required if patch_number is None</span>
<span class="sd">        overlap: Percentage of overlap between patches</span>
<span class="sd">        subfolder_name: name of the subfolder where to store h5 files for defected images and dataset txt</span>
<span class="sd">        train_filename: Name of the file in which to store the mappings between h5 files and labels</span>
<span class="sd">        annotated_good: List of class indices that are considered good other than the background</span>
<span class="sd">        num_workers: Number of processes used to create h5 files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Create a txt file containing tuples path,label where path is a pointer to the generated h5 file and label is the</span>
<span class="sd">            corresponding label</span>

<span class="sd">            Each generated h5 file contains five fields:</span>
<span class="sd">                img_path: Pointer to the location of the original image</span>
<span class="sd">                mask_path: Optional pointer to the mask file, is missing if the mask is completely empty or is</span>
<span class="sd">                not present</span>
<span class="sd">                patch_size: dimension of the patches on the interested image</span>
<span class="sd">                triangles: List of triangles that covers the defect</span>
<span class="sd">                triangles_weights: Which weight should be given to each triangle for sampling</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">patch_number</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">patch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidParameterCombinationException</span><span class="p">(</span><span class="s2">&quot;One between patch number or patch size must be specified!&quot;</span><span class="p">)</span>

    <span class="n">sampling_dataset_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">subfolder_name</span><span class="p">)</span>

    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">sampling_dataset_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">labelled_masks_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;original&quot;</span><span class="p">,</span> <span class="s2">&quot;labelled_masks&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">labelled_masks_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sampling_dataset_folder</span><span class="p">,</span> <span class="n">train_filename</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">num_workers</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidNumWorkersNumberException</span><span class="p">(</span><span class="s2">&quot;Workers must be &gt;= 1&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">num_workers</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Executing generate_patch_sampling_dataset w/ more than 1 worker!&quot;</span><span class="p">)</span>

            <span class="n">split_data_dictionary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">),</span> <span class="n">num_workers</span><span class="p">)</span>

            <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="n">num_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
                <span class="n">res_list</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
                    <span class="n">partial</span><span class="p">(</span>
                        <span class="n">create_h5</span><span class="p">,</span>
                        <span class="n">patch_size</span><span class="o">=</span><span class="n">patch_size</span><span class="p">,</span>
                        <span class="n">patch_number</span><span class="o">=</span><span class="n">patch_number</span><span class="p">,</span>
                        <span class="n">idx_to_class</span><span class="o">=</span><span class="n">idx_to_class</span><span class="p">,</span>
                        <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
                        <span class="n">repeat_good_images</span><span class="o">=</span><span class="n">repeat_good_images</span><span class="p">,</span>
                        <span class="n">balance_defects</span><span class="o">=</span><span class="n">balance_defects</span><span class="p">,</span>
                        <span class="n">annotated_good</span><span class="o">=</span><span class="n">annotated_good</span><span class="p">,</span>
                        <span class="n">output_folder</span><span class="o">=</span><span class="n">output_folder</span><span class="p">,</span>
                        <span class="n">labelled_masks_path</span><span class="o">=</span><span class="n">labelled_masks_path</span><span class="p">,</span>
                        <span class="n">sampling_dataset_folder</span><span class="o">=</span><span class="n">sampling_dataset_folder</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">split_data_dictionary</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">res_list</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">create_h5</span><span class="p">(</span>
                <span class="n">data_dictionary</span><span class="o">=</span><span class="n">data_dictionary</span><span class="p">,</span>
                <span class="n">patch_size</span><span class="o">=</span><span class="n">patch_size</span><span class="p">,</span>
                <span class="n">patch_number</span><span class="o">=</span><span class="n">patch_number</span><span class="p">,</span>
                <span class="n">idx_to_class</span><span class="o">=</span><span class="n">idx_to_class</span><span class="p">,</span>
                <span class="n">overlap</span><span class="o">=</span><span class="n">overlap</span><span class="p">,</span>
                <span class="n">repeat_good_images</span><span class="o">=</span><span class="n">repeat_good_images</span><span class="p">,</span>
                <span class="n">balance_defects</span><span class="o">=</span><span class="n">balance_defects</span><span class="p">,</span>
                <span class="n">annotated_good</span><span class="o">=</span><span class="n">annotated_good</span><span class="p">,</span>
                <span class="n">output_folder</span><span class="o">=</span><span class="n">output_folder</span><span class="p">,</span>
                <span class="n">labelled_masks_path</span><span class="o">=</span><span class="n">labelled_masks_path</span><span class="p">,</span>
                <span class="n">sampling_dataset_folder</span><span class="o">=</span><span class="n">sampling_dataset_folder</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.generate_patch_sliding_window_dataset" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_patch_sliding_window_dataset</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">,</span> <span class="n">subfolder_name</span><span class="p">,</span> <span class="n">patch_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">output_folder</span><span class="o">=</span><span class="s1">&#39;extraction_data&#39;</span><span class="p">,</span> <span class="n">area_threshold</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span> <span class="n">area_defect_threshold</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">mask_extension</span><span class="o">=</span><span class="s1">&#39;_mask&#39;</span><span class="p">,</span> <span class="n">mask_output_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">class_to_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.generate_patch_sliding_window_dataset" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Giving a data_dictionary as:</p>
<blockquote>
<blockquote>
<blockquote>
<p>{
    'base_name': '163931_1_5.jpg',
    'path': 'extraction_data/1/163931_1_5.jpg',
    'mask': 'extraction_data/1/163931_1_5_mask.jpg'
}
This function will extract the patches and save the file and the mask in subdirectory
Args:
    data_dictionary: Dictionary as above
    subfolder_name: Name of the subfolder where to save the extracted patches (output_folder/subfolder_name)
    class_to_idx: Dictionary {"defect": value in mask.. }
    output_folder: root_folder where to extract the data
    area_threshold: minimum percentage of defected patch area present in the mask to classify the patch as defect
    area_defect_threshold: minimum percentage of single defect present in the patch to classify the patch as defect
    mask_extension: extension used to assign image to mask
    mask_output_folder: Optional folder in which to save the masks
    save_mask: flag to save the mask
    patch_number: Optional number of patches for each side, required if patch_size is None
    patch_size: Optional dimension of the patch, required if patch_number is None
    overlap: overlap of the patches [0, 1].</p>
</blockquote>
</blockquote>
</blockquote>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code>None</code>
        –
        <div class="doc-md-description">
          <p>None.</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_patch_sliding_window_dataset</span><span class="p">(</span>
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span>
    <span class="n">subfolder_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">patch_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">patch_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="n">output_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;extraction_data&quot;</span><span class="p">,</span>
    <span class="n">area_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span>
    <span class="n">area_defect_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="n">mask_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;_mask&quot;</span><span class="p">,</span>
    <span class="n">mask_output_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">class_to_idx</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Giving a data_dictionary as:</span>
<span class="sd">    &gt;&gt;&gt; {</span>
<span class="sd">    &gt;&gt;&gt;     &#39;base_name&#39;: &#39;163931_1_5.jpg&#39;,</span>
<span class="sd">    &gt;&gt;&gt;     &#39;path&#39;: &#39;extraction_data/1/163931_1_5.jpg&#39;,</span>
<span class="sd">    &gt;&gt;&gt;     &#39;mask&#39;: &#39;extraction_data/1/163931_1_5_mask.jpg&#39;</span>
<span class="sd">    &gt;&gt;&gt;}</span>
<span class="sd">    This function will extract the patches and save the file and the mask in subdirectory</span>
<span class="sd">    Args:</span>
<span class="sd">        data_dictionary: Dictionary as above</span>
<span class="sd">        subfolder_name: Name of the subfolder where to save the extracted patches (output_folder/subfolder_name)</span>
<span class="sd">        class_to_idx: Dictionary {&quot;defect&quot;: value in mask.. }</span>
<span class="sd">        output_folder: root_folder where to extract the data</span>
<span class="sd">        area_threshold: minimum percentage of defected patch area present in the mask to classify the patch as defect</span>
<span class="sd">        area_defect_threshold: minimum percentage of single defect present in the patch to classify the patch as defect</span>
<span class="sd">        mask_extension: extension used to assign image to mask</span>
<span class="sd">        mask_output_folder: Optional folder in which to save the masks</span>
<span class="sd">        save_mask: flag to save the mask</span>
<span class="sd">        patch_number: Optional number of patches for each side, required if patch_size is None</span>
<span class="sd">        patch_size: Optional dimension of the patch, required if patch_number is None</span>
<span class="sd">        overlap: overlap of the patches [0, 1].</span>

<span class="sd">    Returns:</span>
<span class="sd">        None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">save_mask</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_extension</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">mask_output_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidParameterCombinationException</span><span class="p">(</span>
            <span class="s2">&quot;If mask output folder is not set you must specify a mask extension in order to save masks!&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">patch_number</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">patch_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">InvalidParameterCombinationException</span><span class="p">(</span><span class="s2">&quot;One between patch number or patch size must be specified!&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">):</span>
        <span class="n">base_id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;base_name&quot;</span><span class="p">)</span>
        <span class="n">base_path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span>
        <span class="n">base_mask</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">)</span>

        <span class="k">assert</span> <span class="n">base_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Cannot find base id in data_dictionary&quot;</span>
        <span class="k">assert</span> <span class="n">base_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Cannot find image in data_dictionary&quot;</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">base_path</span><span class="p">))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing </span><span class="si">%s</span><span class="s2"> with shape </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">base_id</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask_patches</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">labelled_mask</span> <span class="o">=</span> <span class="n">labelled_patches</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">base_mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">base_mask</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">labelled_mask</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">patch_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">[</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_size</span>
            <span class="p">[</span><span class="n">patch_num_h</span><span class="p">,</span> <span class="n">patch_num_w</span><span class="p">],</span> <span class="n">step</span> <span class="o">=</span> <span class="n">compute_patch_info_from_patch_dim</span><span class="p">(</span>
                <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">,</span> <span class="n">overlap</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">patch_number</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="p">[</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">],</span> <span class="n">step</span> <span class="o">=</span> <span class="n">compute_patch_info</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">patch_number</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">patch_number</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">overlap</span><span class="p">)</span>
            <span class="p">[</span><span class="n">patch_num_h</span><span class="p">,</span> <span class="n">patch_num_w</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_number</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># mypy does not recognize that this is unreachable</span>
            <span class="k">raise</span> <span class="n">InvalidParameterCombinationException</span><span class="p">(</span><span class="s2">&quot;One between patch number or patch size must be specified!&quot;</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Extracting </span><span class="si">%s</span><span class="s2"> patches with size </span><span class="si">%s</span><span class="s2">, step </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">patch_num_h</span><span class="p">,</span> <span class="n">patch_num_w</span><span class="p">],</span> <span class="p">[</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">],</span> <span class="n">step</span>
        <span class="p">)</span>
        <span class="n">image_patches</span> <span class="o">=</span> <span class="n">extract_patches</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">patch_num_h</span><span class="p">,</span> <span class="n">patch_num_w</span><span class="p">),</span> <span class="p">(</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">),</span> <span class="n">step</span><span class="p">,</span> <span class="n">overlap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">labelled_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Labelled mask cannot be None!&quot;</span><span class="p">)</span>
            <span class="n">mask_patches</span> <span class="o">=</span> <span class="n">extract_patches</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">patch_num_h</span><span class="p">,</span> <span class="n">patch_num_w</span><span class="p">),</span> <span class="p">(</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">),</span> <span class="n">step</span><span class="p">,</span> <span class="n">overlap</span><span class="p">)</span>
            <span class="n">labelled_patches</span> <span class="o">=</span> <span class="n">extract_patches</span><span class="p">(</span>
                <span class="n">labelled_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">patch_num_h</span><span class="p">,</span> <span class="n">patch_num_w</span><span class="p">),</span> <span class="p">(</span><span class="n">patch_height</span><span class="p">,</span> <span class="n">patch_width</span><span class="p">),</span> <span class="n">step</span><span class="p">,</span> <span class="n">overlap</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">image_patches</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">mask_patches</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;Image patches and mask patches mismatch!&quot;</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Image patches shape: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">image_patches</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">__save_patch_dataset</span><span class="p">(</span>
            <span class="n">image_patches</span><span class="o">=</span><span class="n">image_patches</span><span class="p">,</span>
            <span class="n">mask_patches</span><span class="o">=</span><span class="n">mask_patches</span><span class="p">,</span>
            <span class="n">labelled_patches</span><span class="o">=</span><span class="n">labelled_patches</span><span class="p">,</span>
            <span class="n">labelled_mask</span><span class="o">=</span><span class="n">labelled_mask</span><span class="p">,</span>
            <span class="n">image_name</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">base_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">output_folder</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">subfolder_name</span><span class="p">),</span>
            <span class="n">area_threshold</span><span class="o">=</span><span class="n">area_threshold</span><span class="p">,</span>
            <span class="n">area_defect_threshold</span><span class="o">=</span><span class="n">area_defect_threshold</span><span class="p">,</span>
            <span class="n">mask_extension</span><span class="o">=</span><span class="n">mask_extension</span><span class="p">,</span>
            <span class="n">save_mask</span><span class="o">=</span><span class="n">save_mask</span><span class="p">,</span>
            <span class="n">mask_output_folder</span><span class="o">=</span><span class="n">mask_output_folder</span><span class="p">,</span>
            <span class="n">class_to_idx</span><span class="o">=</span><span class="n">class_to_idx</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.get_image_mask_association" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_image_mask_association</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="n">mask_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mask_extension</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">warning_on_missing_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.get_image_mask_association" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Function used to match images and mask from a folder or sub-folders.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>data_folder</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        –
        <div class="doc-md-description">
          <p>root data folder containing images or images and masks</p>
        </div>
      </li>
      <li class="field-body">
        <b>mask_folder</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Optional root directory used to search only the masks</p>
        </div>
      </li>
      <li class="field-body">
        <b>mask_extension</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                <code>&#39;&#39;</code>
)
        –
        <div class="doc-md-description">
          <p>extension used to identify the mask file, it's mandatory if mask_folder is not specified
warning_on_missing_mask: if set to True a warning will be raised if a mask is missing, disable if you know
that many images do not have a mask.</p>
        </div>
      </li>
      <li class="field-body">
        <b>warning_on_missing_mask</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                <code>True</code>
)
        –
        <div class="doc-md-description">
          <p>if set to True a warning will be raised if a mask is missing, disable if you know</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>]</code>
        –
        <div class="doc-md-description">
          <p>List of dict like:</p>
      </div>
      </li>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>]</code>
        –
        <div class="doc-md-description">
          <p>[</p>
      </div>
      </li>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>]</code>
        –
        <div class="doc-md-description">
          <p>{
'base_name': '161927.tiff',
'path': 'test_dataset_patch/images/161927.tiff',
'mask': 'test_dataset_patch/masks/161927_mask.tiff'</p>
      </div>
      </li>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>]</code>
        –
        <div class="doc-md-description">
          <p>}, ...</p>
      </div>
      </li>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>]</code>
        –
        <div class="doc-md-description">
          <p>]</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_image_mask_association</span><span class="p">(</span>
    <span class="n">data_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">mask_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mask_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">warning_on_missing_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function used to match images and mask from a folder or sub-folders.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_folder: root data folder containing images or images and masks</span>
<span class="sd">        mask_folder: Optional root directory used to search only the masks</span>
<span class="sd">        mask_extension: extension used to identify the mask file, it&#39;s mandatory if mask_folder is not specified</span>
<span class="sd">            warning_on_missing_mask: if set to True a warning will be raised if a mask is missing, disable if you know</span>
<span class="sd">            that many images do not have a mask.</span>
<span class="sd">        warning_on_missing_mask: if set to True a warning will be raised if a mask is missing, disable if you know</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of dict like:</span>
<span class="sd">        [</span>
<span class="sd">        {</span>
<span class="sd">            &#39;base_name&#39;: &#39;161927.tiff&#39;,</span>
<span class="sd">            &#39;path&#39;: &#39;test_dataset_patch/images/161927.tiff&#39;,</span>
<span class="sd">            &#39;mask&#39;: &#39;test_dataset_patch/masks/161927_mask.tiff&#39;</span>
<span class="sd">        }, ...</span>
<span class="sd">        ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get all the images from the data folder</span>
    <span class="n">data_images</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="s2">&quot;**&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">),</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">basenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">image</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">data_images</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">basenames</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">basenames</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Found multiple images with the same name and different extension, this is not supported.&quot;</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Found: </span><span class="si">%d</span><span class="s2"> images in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_images</span><span class="p">),</span> <span class="n">data_folder</span><span class="p">)</span>
    <span class="c1"># divide images and mask if in the same folder</span>
    <span class="c1"># if mask folder is specified search mask in that folder</span>
    <span class="k">if</span> <span class="n">mask_folder</span><span class="p">:</span>
        <span class="n">masks_images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">basename</span> <span class="ow">in</span> <span class="n">basenames</span><span class="p">:</span>
            <span class="n">mask_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">mask_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">basename</span><span class="si">}{</span><span class="n">mask_extension</span><span class="si">}</span><span class="s2">.*&quot;</span><span class="p">)</span>
            <span class="n">mask_path_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">mask_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_path_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">masks_images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask_path_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">warning_on_missing_mask</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Mask for </span><span class="si">%s</span><span class="s2"> not found&quot;</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mask_extension</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If no mask folder is provided, mask extension is mandatory it cannot be empty.&quot;</span><span class="p">)</span>

        <span class="n">masks_images</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">data_images</span> <span class="k">if</span> <span class="n">mask_extension</span> <span class="ow">in</span> <span class="n">image</span><span class="p">]</span>
        <span class="n">data_images</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">data_images</span> <span class="k">if</span> <span class="n">mask_extension</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">image</span><span class="p">]</span>

    <span class="c1"># build support dictionary</span>
    <span class="n">unique_images</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;base_name&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">data_images</span><span class="p">]</span>

    <span class="n">images_stem</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">mask_extension</span> <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">unique_images</span><span class="p">]</span>
    <span class="n">masks_stem</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">mask</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">mask</span> <span class="ow">in</span> <span class="n">masks_images</span><span class="p">]</span>

    <span class="c1"># search corrispondency between file or folders</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">image_stem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">images_stem</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">image_stem</span> <span class="ow">in</span> <span class="n">masks_stem</span><span class="p">:</span>
            <span class="n">unique_images</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">masks_images</span><span class="p">[</span><span class="n">masks_stem</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">image_stem</span><span class="p">)]</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unique images with mask: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">([</span><span class="n">uni</span> <span class="k">for</span> <span class="n">uni</span> <span class="ow">in</span> <span class="n">unique_images</span> <span class="k">if</span> <span class="n">uni</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]))</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Unique images with no mask: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">([</span><span class="n">uni</span> <span class="k">for</span> <span class="n">uni</span> <span class="ow">in</span> <span class="n">unique_images</span> <span class="k">if</span> <span class="n">uni</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mask&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">unique_images</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.load_train_file" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load_train_file</span><span class="p">(</span><span class="n">train_file_path</span><span class="p">,</span> <span class="n">include_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">exclude_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_to_skip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.load_train_file" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Load a train file and return a list of samples and a list of targets. It is expected that train files will be in
    the same location as the train_file_path.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>train_file_path</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        –
        <div class="doc-md-description">
          <p>Training file location</p>
        </div>
      </li>
      <li class="field-body">
        <b>include_filter</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Include only samples that contain one of the element of this list</p>
        </div>
      </li>
      <li class="field-body">
        <b>exclude_filter</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>Exclude all samples that contain one of the element of this list</p>
        </div>
      </li>
      <li class="field-body">
        <b>class_to_skip</b>
            (<code><a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#list">list</a>]</code>, default:
                <code>None</code>
)
        –
        <div class="doc-md-description">
          <p>if not None, exlude all the samples with labels present in this list.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>], <a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a>]]</code>
        –
        <div class="doc-md-description">
          <p>List of samples and list of targets</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_train_file</span><span class="p">(</span>
    <span class="n">train_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">include_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">exclude_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">class_to_skip</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a train file and return a list of samples and a list of targets. It is expected that train files will be in</span>
<span class="sd">        the same location as the train_file_path.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_file_path: Training file location</span>
<span class="sd">        include_filter: Include only samples that contain one of the element of this list</span>
<span class="sd">        exclude_filter: Exclude all samples that contain one of the element of this list</span>
<span class="sd">        class_to_skip: if not None, exlude all the samples with labels present in this list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of samples and list of targets</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">train_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">sample</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">class_to_skip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">class_to_skip</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
            <span class="n">targets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="n">include_filter</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">include_filter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">include_filter</span>
    <span class="n">exclude_filter</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">exclude_filter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">exclude_filter</span>

    <span class="n">valid_samples_indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">i</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">include_filter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">f</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">include_filter</span><span class="p">))</span>
        <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">exclude_filter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">f</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">exclude_filter</span><span class="p">))</span>
    <span class="p">]</span>

    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">valid_samples_indices</span><span class="p">]</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">valid_samples_indices</span><span class="p">]</span>

    <span class="n">train_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">train_file_path</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">train_folder</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">samples</span><span class="p">,</span> <span class="n">targets</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.multilabel_stratification" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">multilabel_stratification</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">,</span> <span class="n">val_size</span><span class="p">,</span> <span class="n">test_size</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.multilabel_stratification" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Split data dictionary using multilabel based stratification, place every sample with None
    mask inside the test set,for all the others read the labels contained in the masks
    to create one-hot encoded labels.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>output_folder</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
        –
        <div class="doc-md-description">
          <p>root folder of the dataset</p>
        </div>
      </li>
      <li class="field-body">
        <b>data_dictionary</b>
            (<code><a class="autorefs autorefs-external" title="typing.List" href="https://docs.python.org/3/library/typing.html#typing.List">List</a>[<a class="autorefs autorefs-external" title="typing.Dict" href="https://docs.python.org/3/library/typing.html#typing.Dict">Dict</a>]</code>)
        –
        <div class="doc-md-description">
          <p>Data dictionary as described in generate patch dataset</p>
        </div>
      </li>
      <li class="field-body">
        <b>num_classes</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
        –
        <div class="doc-md-description">
          <p>Number of classes contained in the dataset, required for one hot encoding</p>
        </div>
      </li>
      <li class="field-body">
        <b>val_size</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        –
        <div class="doc-md-description">
          <p>Percentage of data to be used for validation</p>
        </div>
      </li>
      <li class="field-body">
        <b>test_size</b>
            (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
        –
        <div class="doc-md-description">
          <p>Percentage of data to be used for test</p>
        </div>
      </li>
  </ul>
      

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">multilabel_stratification</span><span class="p">(</span>
    <span class="n">output_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data_dictionary</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">val_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">test_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split data dictionary using multilabel based stratification, place every sample with None</span>
<span class="sd">        mask inside the test set,for all the others read the labels contained in the masks</span>
<span class="sd">        to create one-hot encoded labels.</span>

<span class="sd">    Args:</span>
<span class="sd">        output_folder: root folder of the dataset</span>
<span class="sd">        data_dictionary: Data dictionary as described in generate patch dataset</span>
<span class="sd">        num_classes: Number of classes contained in the dataset, required for one hot encoding</span>
<span class="sd">        val_size: Percentage of data to be used for validation</span>
<span class="sd">        test_size: Percentage of data to be used for test</span>
<span class="sd">    Returns:</span>
<span class="sd">        Three data dictionaries, one for training, one for validation and one for test</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">val_size</span> <span class="o">+</span> <span class="n">test_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data_dictionary</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">val_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="n">data_dictionary</span><span class="p">,</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">test_size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">data_dictionary</span>

    <span class="n">test_data_dictionary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">q</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">))</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Number of images with no mask inserted in test_data_dictionary: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_data_dictionary</span><span class="p">))</span>
    <span class="n">empty_test_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_data_dictionary</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">)</span>
    <span class="n">data_dictionary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">q</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_dictionary</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># All the item in the data dictionary have None mask, put everything in test</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;All the images have None mask and the test size is not equal to 1! Put everything in test&quot;</span><span class="p">,</span> <span class="ne">UserWarning</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">test_data_dictionary</span>

    <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_dictionary</span><span class="p">:</span>
        <span class="n">one_hot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_classes</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># this works even if item[&quot;mask&quot;] is already an absolute path</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

        <span class="n">one_hot</span><span class="p">[:,</span> <span class="n">labels</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">one_hot</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">one_hot</span><span class="p">])</span>

    <span class="n">x_test</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">empty_test_size</span> <span class="o">&gt;</span> <span class="n">test_size</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;The percentage of images with None label is greater than the test_size, the newest test_size is&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">empty_test_size</span><span class="si">}</span><span class="s2">!&quot;</span>
            <span class="p">),</span>
            <span class="ne">UserWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">x_train</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x_val</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">iterative_train_test_split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">val_size</span><span class="p">)</span>
        <span class="n">x_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">test_data_dictionary</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">test_size</span> <span class="o">-=</span> <span class="n">empty_test_size</span>
        <span class="n">x_train</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x_remaining</span><span class="p">,</span> <span class="n">y_remaining</span> <span class="o">=</span> <span class="n">iterative_train_test_split</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">val_size</span> <span class="o">+</span> <span class="n">test_size</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">x_remaining</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">test_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x_val</span> <span class="o">=</span> <span class="n">x_remaining</span>
                <span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">elif</span> <span class="n">val_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">x_test</span> <span class="o">=</span> <span class="n">x_remaining</span>
                <span class="n">x_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not enough data to create the test split, only a validation set of size 1 will be created&quot;</span><span class="p">)</span>
                <span class="n">x_val</span> <span class="o">=</span> <span class="n">x_remaining</span>
                <span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_val</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">iterative_train_test_split</span><span class="p">(</span>
                <span class="n">x_remaining</span><span class="p">,</span> <span class="n">y_remaining</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">/</span> <span class="p">(</span><span class="n">val_size</span> <span class="o">+</span> <span class="n">test_size</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="c1"># Here x_test should be always a numpy array, but mypy does not recognize it</span>
        <span class="n">x_test</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">x_test</span><span class="o">.</span><span class="n">tolist</span><span class="p">()]</span>  <span class="c1"># type: ignore[union-attr]</span>
        <span class="n">x_test</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">q</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">test_data_dictionary</span><span class="p">])</span>

    <span class="n">train_data_dictionary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">q</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">))</span>
    <span class="n">val_data_dictionary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">q</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x_val</span><span class="p">,</span> <span class="n">data_dictionary</span><span class="p">))</span>
    <span class="n">test_data_dictionary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">q</span><span class="p">[</span><span class="s2">&quot;base_name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">data_dictionary</span> <span class="o">+</span> <span class="n">test_data_dictionary</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">train_data_dictionary</span><span class="p">,</span> <span class="n">val_data_dictionary</span><span class="p">,</span> <span class="n">test_data_dictionary</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.triangle_area" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">triangle_area</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.triangle_area" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Compute the area of a triangle defined by 3 points.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>triangle</b>
            (<code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>)
        –
        <div class="doc-md-description">
          <p>Array of shape 3x2 containing the coordinates of a triangle.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
        –
        <div class="doc-md-description">
          <p>The area of the triangle</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">triangle_area</span><span class="p">(</span><span class="n">triangle</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the area of a triangle defined by 3 points.</span>

<span class="sd">    Args:</span>
<span class="sd">        triangle: Array of shape 3x2 containing the coordinates of a triangle.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The area of the triangle</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="n">y2</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">y3</span><span class="p">,</span> <span class="n">x3</span><span class="p">]</span> <span class="o">=</span> <span class="n">triangle</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(((</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y3</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span> <span class="o">-</span> <span class="p">((</span><span class="n">x3</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.triangulate_region" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">triangulate_region</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.triangulate_region" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Extract from a binary image containing a single roi (with or without holes) a list of triangles
(and their normalized area) that completely subdivide an approximated polygon defined around mask contours,
the output can be used to easily sample uniformly points that are almost guarantee to lie inside the roi.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>mask</b>
            (<code><span title="scipy.ndimage">ndimage</span></code>)
        –
        <div class="doc-md-description">
          <p>Binary image defining a region of interest</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>], <a class="autorefs autorefs-external" title="typing.Optional" href="https://docs.python.org/3/library/typing.html#typing.Optional">Optional</a>[<a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a>]]</code>
        –
        <div class="doc-md-description">
          <p>Tuple containing:
triangles: a numpy array containing a list of list of vertices (y, x) of the triangles defined over a
    polygon that contains the entire region
weights: areas of each triangle rescaled (area_i / sum(areas))</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">triangulate_region</span><span class="p">(</span><span class="n">mask</span><span class="p">:</span> <span class="n">ndimage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract from a binary image containing a single roi (with or without holes) a list of triangles</span>
<span class="sd">    (and their normalized area) that completely subdivide an approximated polygon defined around mask contours,</span>
<span class="sd">    the output can be used to easily sample uniformly points that are almost guarantee to lie inside the roi.</span>

<span class="sd">    Args:</span>
<span class="sd">        mask: Binary image defining a region of interest</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple containing:</span>
<span class="sd">            triangles: a numpy array containing a list of list of vertices (y, x) of the triangles defined over a</span>
<span class="sd">                polygon that contains the entire region</span>
<span class="sd">            weights: areas of each triangle rescaled (area_i / sum(areas))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">polygon_points</span><span class="p">,</span> <span class="n">hier</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_TREE</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_TC89_L1</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">hier</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># there are holes</span>
        <span class="n">holes</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">binary_fill_holes</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">holes</span> <span class="o">-=</span> <span class="n">mask</span>
        <span class="n">holes</span> <span class="o">=</span> <span class="p">(</span><span class="n">holes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">holes</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># there are holes</span>
            <span class="k">for</span> <span class="n">hole</span> <span class="ow">in</span> <span class="n">regionprops</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">holes</span><span class="p">)):</span>
                <span class="n">y_hole_center</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hole</span><span class="o">.</span><span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">mask</span><span class="p">[</span><span class="n">y_hole_center</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">polygon_points</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_LIST</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_TC89_L1</span><span class="p">)</span>

    <span class="n">final_approx</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Extract a simpler approximation of the contour</span>
    <span class="k">for</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">polygon_points</span><span class="p">:</span>
        <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">cv2</span><span class="o">.</span><span class="n">arcLength</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">approx</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">approxPolyDP</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">final_approx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">approx</span><span class="p">)</span>

    <span class="n">triangles</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">approx</span> <span class="ow">in</span> <span class="n">final_approx</span><span class="p">:</span>
        <span class="n">contours_tripy</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">approx</span><span class="p">]</span>
        <span class="n">current_triangles</span> <span class="o">=</span> <span class="n">earclip</span><span class="p">(</span><span class="n">contours_tripy</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_triangles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># This can only happen is a defect is like one pixel wide...</span>
            <span class="k">continue</span>

        <span class="n">current_triangles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">current_triangles</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">triangles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">triangles</span> <span class="o">=</span> <span class="n">current_triangles</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">triangles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">triangles</span><span class="p">,</span> <span class="n">current_triangles</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">triangles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># Swap x and y to match cv2</span>
    <span class="n">triangles</span> <span class="o">=</span> <span class="n">triangles</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">triangle_area</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">triangles</span><span class="p">])</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span> <span class="o">/</span> <span class="n">weights</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">triangles</span><span class="p">,</span> <span class="n">weights</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="quadra.utils.patch.dataset.trisample" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">trisample</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span></code>

<a href="#quadra.utils.patch.dataset.trisample" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Sample a point uniformly in a triangle.</p>



  <p>Parameters:</p>
  <ul>
      <li class="field-body">
        <b>triangle</b>
            (<code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>)
        –
        <div class="doc-md-description">
          <p>Array of shape 3x2 containing the coordinates of a triangle.</p>
        </div>
      </li>
  </ul>



  <p>Returns:</p>
  <ul>
      <li class="field-body">
            <code><a class="autorefs autorefs-external" title="typing.Tuple" href="https://docs.python.org/3/library/typing.html#typing.Tuple">Tuple</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>, <a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
        –
        <div class="doc-md-description">
          <p>Sample point uniformly in the triangle</p>
      </div>
      </li>
  </ul>

          <details class="quote">
            <summary>Source code in <code>quadra/utils/patch/dataset.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">trisample</span><span class="p">(</span><span class="n">triangle</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample a point uniformly in a triangle.</span>

<span class="sd">    Args:</span>
<span class="sd">        triangle: Array of shape 3x2 containing the coordinates of a triangle.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Sample point uniformly in the triangle</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="n">y2</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">y3</span><span class="p">,</span> <span class="n">x3</span><span class="p">]</span> <span class="o">=</span> <span class="n">triangle</span>

    <span class="n">r1</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

    <span class="n">s1</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">s1</span><span class="p">)</span> <span class="o">+</span> <span class="n">x2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">x3</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">s1</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">s1</span><span class="p">)</span> <span class="o">+</span> <span class="n">y2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span> <span class="o">*</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">y3</span> <span class="o">*</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">s1</span>

    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 Orobix
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.annotate", "content.code.copy", "navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "search": "../../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": ["latest"], "provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>